<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ä¸­åèŠ‚æ—¥éŸ³ç”» - ä¸­å›½é£äº’åŠ¨éŸ³ä¹ä½“éªŒ</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ma+Shan+Zheng&family=ZCOOL+QingKe+HuangYou&family=ZCOOL+XiaoWei&display=swap">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
        }
        
        html, body {
            width: 100%;
            height: 100%;
            overflow: hidden;
            position: fixed;
        }
        
        body {
            background-color: #8B0000;
            background-image: 
                radial-gradient(circle at 10% 20%, rgba(255, 215, 0, 0.15) 0%, transparent 20%),
                radial-gradient(circle at 90% 80%, rgba(255, 215, 0, 0.15) 0%, transparent 20%),
                radial-gradient(circle at 50% 50%, rgba(139, 0, 0, 0.4) 0%, transparent 50%);
            font-family: 'ZCOOL QingKe HuangYou', cursive, sans-serif;
            color: #FFD700;
            height: 100vh;
            overflow: hidden;
            position: relative;
            touch-action: none;
        }
        
        #canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
            display: block;
        }
        
        /* ç¥ç¦è®¡æ•°å™¨ */
        .blessing-counter {
            position: fixed;
            top: clamp(15px, 4vw, 25px);
            left: 50%;
            transform: translateX(-50%);
            z-index: 5;
            background: linear-gradient(145deg, rgba(178, 34, 34, 0.95), rgba(139, 0, 0, 0.95));
            padding: clamp(10px, 3vw, 15px) clamp(20px, 5vw, 30px);
            border-radius: clamp(15px, 4vw, 25px);
            border: clamp(2px, 1vw, 3px) solid #FFD700;
            box-shadow: 
                0 0 clamp(15px, 4vw, 25px) rgba(255, 215, 0, 0.5),
                0 clamp(5px, 2vw, 8px) clamp(10px, 3vw, 15px) rgba(0, 0, 0, 0.4);
            text-align: center;
            display: flex;
            align-items: center;
            gap: clamp(10px, 3vw, 15px);
            animation: counterPulse 3s infinite alternate;
            min-width: clamp(200px, 50vw, 300px);
            justify-content: center;
        }
        
        @keyframes counterPulse {
            0% { transform: translateX(-50%) scale(1); box-shadow: 0 0 15px rgba(255, 215, 0, 0.5); }
            50% { transform: translateX(-50%) scale(1.05); box-shadow: 0 0 25px rgba(255, 215, 0, 0.8); }
            100% { transform: translateX(-50%) scale(1); box-shadow: 0 0 15px rgba(255, 215, 0, 0.5); }
        }
        
        .counter-icon {
            font-size: clamp(1.5rem, 5vw, 2.5rem);
            color: #FFEC19;
            animation: iconFloat 2s infinite ease-in-out;
        }
        
        @keyframes iconFloat {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }
        
        .counter-content {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .counter-label {
            font-size: clamp(0.8rem, 2.5vw, 1.1rem);
            color: #FFD700;
            margin-bottom: 5px;
            text-shadow: 1px 1px 2px #000;
        }
        
        .counter-value {
            font-size: clamp(1.8rem, 7vw, 3rem);
            font-weight: bold;
            color: #FFEC19;
            text-shadow: 
                0 0 10px rgba(255, 87, 34, 0.9),
                0 0 20px rgba(255, 87, 34, 0.6),
                2px 2px 0 #8B0000;
            font-family: 'Ma Shan Zheng', cursive;
            line-height: 1;
        }
        
        .counter-unit {
            font-size: clamp(0.7rem, 2vw, 1rem);
            color: #FFD700;
            margin-top: 2px;
        }
        
        /* é‡Œç¨‹ç¢‘æç¤º */
        .milestone-notification {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
            z-index: 20;
            background: linear-gradient(145deg, rgba(178, 34, 34, 0.98), rgba(139, 0, 0, 0.98));
            padding: clamp(20px, 6vw, 40px);
            border-radius: clamp(20px, 6vw, 40px);
            border: clamp(3px, 1.5vw, 5px) solid #FFD700;
            box-shadow: 
                0 0 clamp(30px, 8vw, 60px) rgba(255, 87, 34, 0.9),
                0 clamp(10px, 4vw, 20px) clamp(30px, 8vw, 50px) rgba(0, 0, 0, 0.6);
            text-align: center;
            max-width: min(90vw, 500px);
            opacity: 0;
            transition: transform 0.5s ease, opacity 0.5s ease;
            pointer-events: none;
        }
        
        .milestone-notification.show {
            opacity: 1;
            transform: translate(-50%, -50%) scale(1);
        }
        
        .milestone-notification h3 {
            font-size: clamp(1.5rem, 6vw, 2.5rem);
            color: #FFEC19;
            margin-bottom: clamp(10px, 4vw, 20px);
            font-family: 'Ma Shan Zheng', cursive;
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.8);
        }
        
        .milestone-notification p {
            font-size: clamp(1rem, 4vw, 1.5rem);
            line-height: 1.5;
            margin-bottom: clamp(15px, 5vw, 25px);
            color: #FFD700;
        }
        
        .milestone-emoji {
            font-size: clamp(3rem, 10vw, 5rem);
            margin-bottom: clamp(15px, 5vw, 25px);
            animation: emojiSpin 2s infinite;
        }
        
        @keyframes emojiSpin {
            0% { transform: rotate(0deg) scale(1); }
            50% { transform: rotate(180deg) scale(1.2); }
            100% { transform: rotate(360deg) scale(1); }
        }
        
        /* ç»Ÿè®¡é¢æ¿ */
        .stats-panel {
            position: fixed;
            top: clamp(15px, 4vw, 25px);
            right: clamp(15px, 4vw, 25px);
            z-index: 5;
            background: linear-gradient(145deg, rgba(178, 34, 34, 0.9), rgba(139, 0, 0, 0.9));
            padding: clamp(10px, 3vw, 15px);
            border-radius: clamp(15px, 4vw, 25px);
            border: clamp(2px, 1vw, 3px) solid #FFD700;
            box-shadow: 0 clamp(3px, 2vw, 6px) clamp(8px, 3vw, 15px) rgba(0, 0, 0, 0.4);
            display: none;
            flex-direction: column;
            gap: clamp(8px, 2vw, 12px);
            min-width: clamp(120px, 30vw, 180px);
        }
        
        .stats-panel.show {
            display: flex;
        }
        
        .stats-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: clamp(0.8rem, 2.5vw, 1rem);
            padding: clamp(5px, 1.5vw, 8px) 0;
            border-bottom: 1px dashed rgba(255, 215, 0, 0.3);
        }
        
        .stats-item:last-child {
            border-bottom: none;
        }
        
        .stats-label {
            color: #FFD700;
        }
        
        .stats-value {
            color: #FFEC19;
            font-weight: bold;
            font-size: clamp(1rem, 3vw, 1.2rem);
        }
        
        /* ä¸­å¤®å›ºå®šä½¿ç”¨è¯´æ˜ - é»˜è®¤éšè— */
        .instructions-center {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 10;
            background: linear-gradient(145deg, rgba(178, 34, 34, 0.98), rgba(139, 0, 0, 0.98));
            padding: clamp(15px, 4vw, 30px) clamp(20px, 5vw, 40px);
            border-radius: clamp(15px, 4vw, 25px);
            border: clamp(2px, 1vw, 4px) solid #FFD700;
            max-width: min(95vw, 800px);
            width: 90vw;
            box-shadow: 
                0 0 clamp(20px, 5vw, 40px) rgba(255, 87, 34, 0.8),
                0 clamp(5px, 2vw, 10px) clamp(15px, 4vw, 30px) rgba(0, 0, 0, 0.5),
                inset 0 0 clamp(10px, 3vw, 20px) rgba(255, 215, 0, 0.3);
            text-align: center;
            pointer-events: auto;
            animation: glow 3s infinite alternate;
            display: none;
            opacity: 0;
            transition: opacity 0.5s ease;
            max-height: 85vh;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }
        
        .instructions-center.show {
            display: block;
            opacity: 1;
        }
        
        @keyframes glow {
            0% { box-shadow: 0 0 clamp(15px, 4vw, 30px) rgba(255, 87, 34, 0.7), 0 clamp(5px, 2vw, 10px) clamp(15px, 4vw, 30px) rgba(0, 0, 0, 0.5), inset 0 0 clamp(10px, 3vw, 20px) rgba(255, 215, 0, 0.3); }
            100% { box-shadow: 0 0 clamp(25px, 6vw, 50px) rgba(255, 87, 34, 1), 0 clamp(8px, 3vw, 15px) clamp(20px, 5vw, 40px) rgba(0, 0, 0, 0.6), inset 0 0 clamp(15px, 4vw, 30px) rgba(255, 215, 0, 0.5); }
        }
        
        /* å…³é—­æŒ‰é’® */
        .close-btn {
            position: absolute;
            top: clamp(8px, 2vw, 15px);
            right: clamp(10px, 3vw, 20px);
            background: #FFD700;
            color: #8B0000;
            border: none;
            width: clamp(30px, 8vw, 40px);
            height: clamp(30px, 8vw, 40px);
            border-radius: 50%;
            font-size: clamp(18px, 5vw, 24px);
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
            box-shadow: 0 clamp(2px, 1vw, 4px) clamp(4px, 2vw, 8px) rgba(0, 0, 0, 0.3);
            z-index: 11;
            padding: 0;
            line-height: 1;
        }
        
        .close-btn:hover, .close-btn:active {
            background: #FFEC19;
            transform: scale(1.1) rotate(90deg);
            box-shadow: 0 clamp(3px, 1.5vw, 6px) clamp(6px, 3vw, 12px) rgba(0, 0, 0, 0.4);
        }
        
        .instructions-center h1 {
            font-family: 'Ma Shan Zheng', cursive;
            font-size: clamp(1.8rem, 6vw, 3.5rem);
            color: #FFD700;
            text-shadow: 
                0 0 clamp(8px, 2vw, 15px) rgba(255, 87, 34, 0.9),
                0 0 clamp(15px, 4vw, 30px) rgba(255, 87, 34, 0.6),
                clamp(2px, 1vw, 3px) clamp(2px, 1vw, 3px) 0 #8B0000;
            margin-bottom: clamp(8px, 2vw, 15px);
            letter-spacing: clamp(3px, 2vw, 8px);
            line-height: 1.2;
        }
        
        .instructions-center h2 {
            color: #FFD700;
            font-size: clamp(1.2rem, 4vw, 2rem);
            margin-bottom: clamp(15px, 4vw, 25px);
            text-shadow: clamp(1px, 0.5vw, 2px) clamp(1px, 0.5vw, 2px) 0 #8B0000;
            border-bottom: clamp(2px, 1vw, 3px) solid #FFD700;
            padding-bottom: clamp(5px, 2vw, 10px);
            display: inline-block;
            line-height: 1.3;
        }
        
        .instruction-item {
            font-size: clamp(1rem, 3.5vw, 1.8rem);
            line-height: 1.6;
            margin-bottom: clamp(10px, 3vw, 15px);
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: flex-start;
            text-align: left;
            padding: 0 clamp(5px, 2vw, 10px);
        }
        
        .highlight {
            color: #FFEC19;
            font-weight: bold;
            background-color: rgba(139, 0, 0, 0.7);
            padding: clamp(3px, 1vw, 4px) clamp(8px, 2vw, 12px);
            border-radius: clamp(5px, 2vw, 10px);
            border: clamp(1px, 0.5vw, 2px) solid #FFD700;
            margin: 0 clamp(4px, 1vw, 8px);
            display: inline-block;
            text-shadow: 1px 1px 2px #000;
            font-size: clamp(0.9rem, 3vw, 1.6rem);
            white-space: nowrap;
        }
        
        .icon {
            font-size: clamp(1.2rem, 4vw, 2.2rem);
            margin-right: clamp(8px, 3vw, 15px);
            min-width: clamp(30px, 8vw, 50px);
            flex-shrink: 0;
        }
        
        .festival-elements {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: clamp(10px, 3vw, 20px);
            margin-top: clamp(15px, 4vw, 25px);
            padding-top: clamp(10px, 3vw, 20px);
            border-top: clamp(2px, 1vw, 3px) dashed #FFD700;
        }
        
        .element-sample {
            width: clamp(50px, 15vw, 100px);
            height: clamp(50px, 15vw, 100px);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: clamp(1.8rem, 6vw, 3.5rem);
            border-radius: clamp(10px, 3vw, 20px);
            background: linear-gradient(145deg, rgba(255, 87, 34, 0.8), rgba(178, 34, 34, 0.9));
            border: clamp(2px, 1vw, 3px) solid #FFD700;
            box-shadow: 0 clamp(3px, 2vw, 6px) clamp(8px, 3vw, 15px) rgba(0, 0, 0, 0.4);
            transition: all 0.3s;
            flex-shrink: 0;
        }
        
        .element-sample:hover, .element-sample:active {
            transform: scale(1.15) rotate(5deg);
            box-shadow: 0 clamp(5px, 3vw, 10px) clamp(12px, 4vw, 25px) rgba(0, 0, 0, 0.6);
        }
        
        /* ç¦å­—å€’è½¬æ ·å¼ */
        .fu-character {
            transform: rotate(180deg);
            display: inline-block;
            font-size: clamp(1.5rem, 5vw, 3rem);
        }
        
        .subtitle {
            font-size: clamp(0.9rem, 3vw, 1.5rem);
            color: #FFEC19;
            margin-top: clamp(10px, 3vw, 15px);
            font-style: italic;
            text-shadow: 1px 1px 2px #000;
            padding: 0 clamp(10px, 3vw, 20px);
        }
        
        /* ç§»åŠ¨ç«¯ä¼˜åŒ–æ§åˆ¶æ  */
        .controls {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            display: flex;
            justify-content: space-around;
            gap: clamp(8px, 3vw, 25px);
            z-index: 5;
            pointer-events: auto;
            padding: clamp(10px, 3vw, 15px) clamp(15px, 4vw, 25px);
            background: linear-gradient(to top, rgba(139, 0, 0, 0.9), rgba(178, 34, 34, 0.7));
            border-top: clamp(2px, 1vw, 3px) solid #FFD700;
            box-shadow: 0 -5px 20px rgba(0, 0, 0, 0.3);
        }
        
        button {
            background: linear-gradient(to bottom, #B22222, #8B0000);
            color: #FFD700;
            border: clamp(2px, 1vw, 3px) solid #FFD700;
            padding: clamp(8px, 3vw, 12px) clamp(12px, 4vw, 20px);
            font-size: clamp(0.9rem, 3.5vw, 1.3rem);
            border-radius: clamp(20px, 8vw, 40px);
            cursor: pointer;
            transition: all 0.3s;
            font-family: 'ZCOOL XiaoWei', serif;
            font-weight: bold;
            box-shadow: 0 clamp(3px, 2vw, 6px) clamp(8px, 3vw, 15px) rgba(0, 0, 0, 0.4);
            text-shadow: 1px 1px 2px #000;
            letter-spacing: 1px;
            flex: 1;
            min-width: 0;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: clamp(36px, 10vw, 48px);
        }
        
        button:hover, button:active {
            background: linear-gradient(to bottom, #8B0000, #B22222);
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 clamp(5px, 3vw, 12px) clamp(12px, 4vw, 25px) rgba(0, 0, 0, 0.6);
            border-color: #FFEC19;
            color: #FFEC19;
        }
        
        /* æ˜¾ç¤ºè¯´æ˜æŒ‰é’® - ç§»åŠ¨ç«¯ä¼˜åŒ– */
        #showInstructionsBtn {
            position: fixed;
            top: clamp(80px, 20vw, 100px);
            left: clamp(15px, 4vw, 25px);
            z-index: 5;
            background: linear-gradient(to bottom, #B22222, #8B0000);
            padding: clamp(8px, 3vw, 10px) clamp(12px, 4vw, 20px);
            font-size: clamp(0.9rem, 3.5vw, 1.2rem);
            border-radius: clamp(15px, 6vw, 30px);
            box-shadow: 0 clamp(3px, 2vw, 6px) clamp(8px, 3vw, 15px) rgba(0, 0, 0, 0.4);
            min-width: auto;
            flex: none;
            width: auto;
            max-width: 40vw;
            white-space: nowrap;
        }
        
        /* æ˜¾ç¤ºç»Ÿè®¡æŒ‰é’® */
        #showStatsBtn {
            position: fixed;
            top: clamp(130px, 30vw, 150px);
            left: clamp(15px, 4vw, 25px);
            z-index: 5;
            background: linear-gradient(to bottom, #B22222, #8B0000);
            padding: clamp(8px, 3vw, 10px) clamp(12px, 4vw, 20px);
            font-size: clamp(0.9rem, 3.5vw, 1.2rem);
            border-radius: clamp(15px, 6vw, 30px);
            box-shadow: 0 clamp(3px, 2vw, 6px) clamp(8px, 3vw, 15px) rgba(0, 0, 0, 0.4);
            min-width: auto;
            flex: none;
            width: auto;
            max-width: 40vw;
            white-space: nowrap;
        }
        
        .sound-status {
            position: fixed;
            bottom: clamp(70px, 20vw, 90px);
            right: clamp(15px, 4vw, 25px);
            background: linear-gradient(145deg, rgba(178, 34, 34, 0.9), rgba(139, 0, 0, 0.9));
            padding: clamp(8px, 3vw, 10px) clamp(12px, 4vw, 20px);
            border-radius: clamp(15px, 6vw, 30px);
            border: clamp(2px, 1vw, 3px) solid #FFD700;
            font-size: clamp(0.8rem, 3vw, 1.1rem);
            pointer-events: auto;
            box-shadow: 0 clamp(3px, 2vw, 6px) clamp(8px, 3vw, 15px) rgba(0, 0, 0, 0.4);
            z-index: 5;
            display: flex;
            align-items: center;
            gap: 8px;
            max-width: 40vw;
            white-space: nowrap;
        }
        
        .sound-status span {
            color: #4CAF50;
            font-weight: bold;
            font-size: clamp(0.9rem, 3.5vw, 1.3rem);
            text-shadow: 1px 1px 2px #000;
        }
        
        footer {
            position: fixed;
            bottom: clamp(60px, 20vw, 80px);
            width: 100%;
            text-align: center;
            font-size: clamp(0.7rem, 2.5vw, 1rem);
            color: rgba(255, 255, 255, 0.8);
            padding: 0 clamp(10px, 3vw, 20px);
            z-index: 2;
            text-shadow: 1px 1px 2px #000;
            pointer-events: none;
        }
        
        /* çƒŸèŠ±åŠ¨ç”» */
        @keyframes firework {
            0% { transform: translate(-50%, -50%) scale(0); opacity: 1; }
            100% { transform: translate(-50%, -50%) scale(1); opacity: 0; }
        }
        
        .firework {
            position: absolute;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            animation: firework 0.8s ease-out forwards;
        }
        
        /* å“åº”å¼è°ƒæ•´ */
        @media (max-width: 480px) {
            .blessing-counter {
                min-width: 180px;
                padding: 10px 15px;
            }
            
            .counter-value {
                font-size: 2rem;
            }
            
            .controls {
                padding: 10px 15px;
                gap: 10px;
            }
            
            button {
                padding: 8px 12px;
                font-size: 0.8rem;
                min-height: 36px;
            }
            
            #showInstructionsBtn, #showStatsBtn {
                top: auto;
                bottom: 120px;
                left: 15px;
            }
            
            #showStatsBtn {
                bottom: 170px;
            }
            
            .sound-status {
                bottom: 120px;
                right: 15px;
            }
        }
        
        @media (min-width: 768px) and (max-width: 1024px) {
            .blessing-counter {
                min-width: 250px;
            }
            
            .counter-value {
                font-size: 2.5rem;
            }
        }
        
        @media (min-width: 1025px) {
            .blessing-counter {
                min-width: 300px;
            }
        }
        
        /* é˜²æ­¢æ–‡æœ¬é€‰æ‹© */
        .no-select {
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }
    </style>
</head>
<body class="no-select">
    <canvas id="canvas"></canvas>
    
    <!-- ç¥ç¦è®¡æ•°å™¨ -->
    <div class="blessing-counter">
        <div class="counter-icon">ğŸ</div>
        <div class="counter-content">
            <div class="counter-label">å·²æ”¶åˆ°ç¥ç¦</div>
            <div class="counter-value" id="blessingCount">0</div>
            <div class="counter-unit">ä¸ªç¥ç¦</div>
        </div>
    </div>
    
    <!-- é‡Œç¨‹ç¢‘æç¤º -->
    <div class="milestone-notification" id="milestoneNotification">
        <div class="milestone-emoji" id="milestoneEmoji">ğŸ‰</div>
        <h3 id="milestoneTitle">æ­å–œï¼</h3>
        <p id="milestoneMessage">æ‚¨å·²æ”¶åˆ°ç¬¬ä¸€ä¸ªç¥ç¦ï¼</p>
        <p>ç»§ç»­ç‚¹å‡»å±å¹•æ”¶é›†æ›´å¤šç¥ç¦ï¼</p>
    </div>
    
    <!-- ç»Ÿè®¡é¢æ¿ -->
    <div class="stats-panel" id="statsPanel">
        <div class="stats-item">
            <span class="stats-label">æ€»ç¥ç¦æ•°:</span>
            <span class="stats-value" id="statsTotal">0</span>
        </div>
        <div class="stats-item">
            <span class="stats-label">çº¢åŒ…ç¥ç¦:</span>
            <span class="stats-value" id="statsRedEnvelope">0</span>
        </div>
        <div class="stats-item">
            <span class="stats-label">ç¦å­—ç¥ç¦:</span>
            <span class="stats-value" id="statsFuCharacter">0</span>
        </div>
        <div class="stats-item">
            <span class="stats-label">ç¯ç¬¼ç¥ç¦:</span>
            <span class="stats-value" id="statsLantern">0</span>
        </div>
        <div class="stats-item">
            <span class="stats-label">å…¶ä»–ç¥ç¦:</span>
            <span class="stats-value" id="statsOther">0</span>
        </div>
        <div class="stats-item">
            <span class="stats-label">æœ€é«˜è¿å‡»:</span>
            <span class="stats-value" id="statsCombo">0</span>
        </div>
    </div>
    
    <!-- ä¸­å¤®å›ºå®šä½¿ç”¨è¯´æ˜ - é»˜è®¤éšè— -->
    <div class="instructions-center" id="instructionsPanel">
        <button class="close-btn" id="closeInstructionsBtn">Ã—</button>
        <h1>ğŸ† ä¸­åèŠ‚æ—¥éŸ³ç”» ğŸ†</h1>
        <h2>ğŸµ äº’åŠ¨ä½¿ç”¨è¯´æ˜ ğŸµ</h2>
        
        <div class="instruction-item">
            <span class="icon">ğŸ–±ï¸</span>
            <div><span class="highlight">ç‚¹å‡»å±å¹•ä»»æ„ä½ç½®</span> - ç”ŸæˆèŠ‚æ—¥å…ƒç´ å¹¶æ”¶é›†ç¥ç¦</div>
        </div>
        
        <div class="instruction-item">
            <span class="icon">ğŸ¯</span>
            <div>æ”¶é›†æ›´å¤šç¥ç¦è§£é”<span class="highlight">é‡Œç¨‹ç¢‘æˆå°±</span></div>
        </div>
        
        <div class="instruction-item">
            <span class="icon">ğŸ“Š</span>
            <div>æŸ¥çœ‹<span class="highlight">è¯¦ç»†ç»Ÿè®¡</span>äº†è§£æ‚¨çš„ç¥ç¦æ”¶é›†æƒ…å†µ</div>
        </div>
        
        <div class="instruction-item">
            <span class="icon">âŒ¨ï¸</span>
            <div>æŒ‰ä¸‹é”®ç›˜ <span class="highlight">A-Z ä»»æ„é”®</span> - è§¦å‘ä¸åŒç¥ç¦</div>
        </div>
        
        <div class="instruction-item">
            <span class="icon">â†•ï¸</span>
            <div><span class="highlight">æ‹–åŠ¨é¼ æ ‡/æ‰‹æŒ‡æ»‘åŠ¨</span> - æŒç»­æ”¶é›†ç¥ç¦</div>
        </div>
        
        <div class="instruction-item">
            <span class="icon">â¡</span>
            <div>æŒ‰ä¸‹ <span class="highlight">ç©ºæ ¼é”®</span> - æ¸…ç©ºç”»é¢</div>
        </div>
        
        <div class="festival-elements">
            <div class="element-sample">ğŸ§§</div>
            <div class="element-sample"><span class="fu-character">ç¦</span></div>
            <div class="element-sample">ğŸ®</div>
            <div class="element-sample">ğŸ†</div>
            <div class="element-sample">ğŸŠ</div>
            <div class="element-sample">ğŸ¥Ÿ</div>
        </div>
        
        <div class="subtitle">æ”¶é›†ç¥ç¦ï¼Œè§£é”æˆå°±ï¼Œæ„Ÿå—èŠ‚æ—¥å–œåº†æ°›å›´ï¼</div>
    </div>
    
    <!-- æ˜¾ç¤ºè¯´æ˜æŒ‰é’® -->
    <button id="showInstructionsBtn">ğŸ“– æ˜¾ç¤ºè¯´æ˜</button>
    
    <!-- æ˜¾ç¤ºç»Ÿè®¡æŒ‰é’® -->
    <button id="showStatsBtn">ğŸ“Š æ˜¾ç¤ºç»Ÿè®¡</button>
    
    <div class="controls">
        <button id="clearBtn">æ¸…ç©ºç”»é¢ ğŸ§¹</button>
        <button id="toggleSound">åˆ‡æ¢å£°éŸ³ ğŸ”Š</button>
        <button id="changeBg">æ›´æ¢èƒŒæ™¯ ğŸ¨</button>
        <button id="resetStats">é‡ç½®ç»Ÿè®¡ ğŸ”„</button>
    </div>
    
    <div class="sound-status">
        å£°éŸ³: <span id="soundStatus">å¼€å¯ ğŸ”Š</span>
    </div>
    
    <footer>
        <p>ğŸŠ è®¾è®¡çµæ„Ÿæ¥æºäºä¼ ç»Ÿä¸­å›½èŠ‚æ—¥ | æœ¬é¡µé¢æ‰€æœ‰éŸ³æ•ˆä¸ºæ¨¡æ‹Ÿæ°‘æ—ä¹å™¨å£°éŸ³ ğŸŠ</p>
    </footer>

    <script>
        // æ£€æµ‹ç§»åŠ¨è®¾å¤‡
        const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
        
        // è·å–Canvaså…ƒç´ å’Œä¸Šä¸‹æ–‡
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        
        // åˆå§‹åŒ–Canvaså°ºå¯¸
        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }
        
        resizeCanvas();
        
        // è·å–UIå…ƒç´ 
        const instructionsPanel = document.getElementById('instructionsPanel');
        const closeInstructionsBtn = document.getElementById('closeInstructionsBtn');
        const showInstructionsBtn = document.getElementById('showInstructionsBtn');
        const showStatsBtn = document.getElementById('showStatsBtn');
        const statsPanel = document.getElementById('statsPanel');
        const milestoneNotification = document.getElementById('milestoneNotification');
        const milestoneEmoji = document.getElementById('milestoneEmoji');
        const milestoneTitle = document.getElementById('milestoneTitle');
        const milestoneMessage = document.getElementById('milestoneMessage');
        
        // éŸ³é¢‘ä¸Šä¸‹æ–‡
        let audioContext;
        let isSoundEnabled = true;
        const soundStatus = document.getElementById('soundStatus');
        const toggleSoundBtn = document.getElementById('toggleSound');
        const clearBtn = document.getElementById('clearBtn');
        const changeBgBtn = document.getElementById('changeBg');
        const resetStatsBtn = document.getElementById('resetStats');
        
        // ç¥ç¦è®¡æ•°å…ƒç´ 
        const blessingCountElement = document.getElementById('blessingCount');
        const statsTotalElement = document.getElementById('statsTotal');
        const statsRedEnvelopeElement = document.getElementById('statsRedEnvelope');
        const statsFuCharacterElement = document.getElementById('statsFuCharacter');
        const statsLanternElement = document.getElementById('statsLantern');
        const statsOtherElement = document.getElementById('statsOther');
        const statsComboElement = document.getElementById('statsCombo');
        
        // ç¥ç¦ç»Ÿè®¡æ•°æ®
        let blessingStats = {
            total: 0,
            byType: {
                redEnvelope: 0,
                fuCharacter: 0,
                lantern: 0,
                other: 0
            },
            combo: 0,
            currentCombo: 0,
            lastBlessingTime: 0,
            milestones: []
        };
        
        // é‡Œç¨‹ç¢‘è®¾ç½®
        const milestones = [
            { count: 1, emoji: "ğŸ‰", title: "ç¬¬ä¸€ä¸ªç¥ç¦ï¼", message: "æ‚¨å·²æ”¶åˆ°ç¬¬ä¸€ä¸ªèŠ‚æ—¥ç¥ç¦ï¼" },
            { count: 10, emoji: "ğŸ§§", title: "åå…¨åç¾ï¼", message: "å·²æ”¶é›†10ä¸ªç¥ç¦ï¼Œç»§ç»­åŠªåŠ›ï¼" },
            { count: 25, emoji: "ğŸ®", title: "åŒå–œä¸´é—¨ï¼", message: "25ä¸ªç¥ç¦è¾¾æˆï¼Œç¦æ°”æ»¡æ»¡ï¼" },
            { count: 50, emoji: "ğŸŠ", title: "äº”ç¦ä¸´é—¨ï¼", message: "50ä¸ªç¥ç¦ï¼æ‚¨çœŸæ˜¯ç¦æ˜Ÿé«˜ç…§ï¼" },
            { count: 100, emoji: "ğŸ’°", title: "ç™¾ç¦å…·è‡»ï¼", message: "100ä¸ªç¥ç¦ï¼ç¦æ°”çˆ†æ£šï¼" },
            { count: 250, emoji: "ğŸ†", title: "ç¦è¿äº¨é€šï¼", message: "250ä¸ªç¥ç¦ï¼ç¦æ°”å†²å¤©ï¼" },
            { count: 500, emoji: "ğŸ‘‘", title: "ç¦å¦‚ä¸œæµ·ï¼", message: "500ä¸ªç¥ç¦ï¼ç¦æ°”ç‹è€…ï¼" },
            { count: 1000, emoji: "ğŸ†", title: "åƒç¦ä¸‡ç¥¥ï¼", message: "1000ä¸ªç¥ç¦ï¼ç¦æ°”è‡³å°Šï¼" }
        ];
        
        // ä¿å­˜å’ŒåŠ è½½ç»Ÿè®¡æ•°æ®
        function saveStats() {
            localStorage.setItem('blessingStats', JSON.stringify(blessingStats));
        }
        
        function loadStats() {
            const savedStats = localStorage.getItem('blessingStats');
            if (savedStats) {
                blessingStats = JSON.parse(savedStats);
                updateBlessingCount();
                updateStatsPanel();
            }
        }
        
        // é‡ç½®ç»Ÿè®¡æ•°æ®
        function resetStats() {
            if (confirm("ç¡®å®šè¦é‡ç½®æ‰€æœ‰ç»Ÿè®¡æ•°æ®å—ï¼Ÿè¿™å°†æ¸…é™¤æ‚¨çš„ç¥ç¦è®¡æ•°å’Œæˆå°±è®°å½•ã€‚")) {
                blessingStats = {
                    total: 0,
                    byType: {
                        redEnvelope: 0,
                        fuCharacter: 0,
                        lantern: 0,
                        other: 0
                    },
                    combo: 0,
                    currentCombo: 0,
                    lastBlessingTime: 0,
                    milestones: []
                };
                updateBlessingCount();
                updateStatsPanel();
                saveStats();
                
                // æ˜¾ç¤ºé‡ç½®æç¤º
                showMilestoneNotification("ğŸ”„", "ç»Ÿè®¡å·²é‡ç½®", "æ‰€æœ‰ç»Ÿè®¡æ•°æ®å·²æ¸…é›¶ï¼Œé‡æ–°å¼€å§‹æ”¶é›†ç¥ç¦å§ï¼");
            }
        }
        
        // æ›´æ–°ç¥ç¦è®¡æ•°æ˜¾ç¤º
        function updateBlessingCount() {
            blessingCountElement.textContent = blessingStats.total;
            statsTotalElement.textContent = blessingStats.total;
            
            // æ ¹æ®è®¡æ•°å¤§å°è°ƒæ•´åŠ¨ç”»
            if (blessingStats.total > 0) {
                blessingCountElement.style.fontSize = clampSize(1.8, 3, blessingStats.total, 1000) + 'rem';
            }
        }
        
        // è¾…åŠ©å‡½æ•°ï¼šæ ¹æ®æ•°å€¼è°ƒæ•´å¤§å°
        function clampSize(minRem, maxRem, value, maxValue) {
            const scale = Math.min(value / maxValue, 1);
            return minRem + (maxRem - minRem) * scale;
        }
        
        // æ›´æ–°ç»Ÿè®¡é¢æ¿
        function updateStatsPanel() {
            statsRedEnvelopeElement.textContent = blessingStats.byType.redEnvelope;
            statsFuCharacterElement.textContent = blessingStats.byType.fuCharacter;
            statsLanternElement.textContent = blessingStats.byType.lantern;
            statsOtherElement.textContent = blessingStats.byType.other;
            statsComboElement.textContent = blessingStats.combo;
        }
        
        // æ˜¾ç¤ºé‡Œç¨‹ç¢‘é€šçŸ¥
        function showMilestoneNotification(emoji, title, message) {
            milestoneEmoji.textContent = emoji;
            milestoneTitle.textContent = title;
            milestoneMessage.textContent = message;
            
            milestoneNotification.classList.add('show');
            
            // æ’­æ”¾ç‰¹æ®ŠéŸ³æ•ˆ
            playMilestoneSound();
            
            // 5ç§’åè‡ªåŠ¨éšè—
            setTimeout(() => {
                milestoneNotification.classList.remove('show');
            }, 5000);
        }
        
        // æ£€æŸ¥é‡Œç¨‹ç¢‘
        function checkMilestones() {
            const currentTotal = blessingStats.total;
            
            for (const milestone of milestones) {
                if (currentTotal >= milestone.count && !blessingStats.milestones.includes(milestone.count)) {
                    // è§£é”æ–°é‡Œç¨‹ç¢‘
                    blessingStats.milestones.push(milestone.count);
                    saveStats();
                    
                    // æ˜¾ç¤ºé‡Œç¨‹ç¢‘é€šçŸ¥
                    showMilestoneNotification(milestone.emoji, milestone.title, milestone.message);
                    
                    // æ’­æ”¾åº†ç¥åŠ¨ç”»
                    createCelebrationEffect();
                    break; // æ¯æ¬¡åªæ˜¾ç¤ºä¸€ä¸ªé‡Œç¨‹ç¢‘
                }
            }
        }
        
        // åˆ›å»ºåº†ç¥æ•ˆæœ
        function createCelebrationEffect() {
            // åœ¨å±å¹•ä¸­å¤®ç”Ÿæˆå¤§é‡çƒŸèŠ±
            for (let i = 0; i < 20; i++) {
                setTimeout(() => {
                    const x = canvas.width / 2 + (Math.random() - 0.5) * 200;
                    const y = canvas.height / 2 + (Math.random() - 0.5) * 200;
                    createFirework(x, y, getRandomColor(), false);
                }, i * 100);
            }
            
            // åœ¨è®¡æ•°å™¨å‘¨å›´ç”Ÿæˆæ—‹è½¬å…ƒç´ 
            for (let i = 0; i < 12; i++) {
                setTimeout(() => {
                    const angle = (i / 12) * Math.PI * 2;
                    const radius = 100;
                    const x = canvas.width / 2 + Math.cos(angle) * radius;
                    const y = canvas.height / 2 + Math.sin(angle) * radius;
                    
                    const elementIndex = Math.floor(Math.random() * festivalElements.length);
                    const keyIndex = Math.floor(Math.random() * 26);
                    drawFestivalElement(x, y, elementIndex, keyIndex, false);
                }, i * 150);
            }
        }
        
        // æ’­æ”¾é‡Œç¨‹ç¢‘éŸ³æ•ˆ
        function playMilestoneSound() {
            if (!isSoundEnabled || !audioContext) return;
            
            try {
                // åˆ›å»ºæ›´å–œåº†çš„é‡Œç¨‹ç¢‘éŸ³æ•ˆ
                const now = audioContext.currentTime;
                
                // æ’­æ”¾ä¸€ç»„å–œåº†çš„éŸ³ç¬¦
                const frequencies = [523.25, 659.25, 783.99, 1046.50]; // C5, E5, G5, C6
                
                frequencies.forEach((freq, index) => {
                    setTimeout(() => {
                        const oscillator = audioContext.createOscillator();
                        const gainNode = audioContext.createGain();
                        
                        oscillator.connect(gainNode);
                        gainNode.connect(audioContext.destination);
                        
                        oscillator.frequency.value = freq;
                        oscillator.type = 'sine';
                        
                        gainNode.gain.setValueAtTime(0.5, audioContext.currentTime);
                        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.8);
                        
                        oscillator.start(audioContext.currentTime);
                        oscillator.stop(audioContext.currentTime + 0.8);
                    }, index * 150);
                });
            } catch (e) {
                console.log("æ’­æ”¾é‡Œç¨‹ç¢‘éŸ³æ•ˆæ—¶å‡ºé”™:", e);
            }
        }
        
        // è·å–éšæœºé¢œè‰²
        function getRandomColor() {
            const colors = ['#FF0000', '#FFD700', '#FF6B6B', '#4CAF50', '#2196F3', '#9C27B0', '#FF9800', '#00BCD4'];
            return colors[Math.floor(Math.random() * colors.length)];
        }
        
        // å¢åŠ ç¥ç¦è®¡æ•°
        function addBlessingCount(elementType) {
            const now = Date.now();
            
            // æ›´æ–°è¿å‡»è®¡æ•°
            if (now - blessingStats.lastBlessingTime < 2000) { // 2ç§’å†…å†æ¬¡ç‚¹å‡»ç®—è¿å‡»
                blessingStats.currentCombo++;
                if (blessingStats.currentCombo > blessingStats.combo) {
                    blessingStats.combo = blessingStats.currentCombo;
                }
            } else {
                blessingStats.currentCombo = 1;
            }
            
            blessingStats.lastBlessingTime = now;
            
            // æ›´æ–°æ€»è®¡æ•°
            blessingStats.total++;
            
            // æ›´æ–°ç±»å‹è®¡æ•°
            if (elementType === 'redEnvelope') {
                blessingStats.byType.redEnvelope++;
            } else if (elementType === 'fuCharacter') {
                blessingStats.byType.fuCharacter++;
            } else if (elementType === 'lantern') {
                blessingStats.byType.lantern++;
            } else {
                blessingStats.byType.other++;
            }
            
            // æ›´æ–°æ˜¾ç¤º
            updateBlessingCount();
            updateStatsPanel();
            
            // æ£€æŸ¥é‡Œç¨‹ç¢‘
            checkMilestones();
            
            // ä¿å­˜æ•°æ®
            saveStats();
            
            // æ›´æ–°è®¡æ•°å™¨åŠ¨ç”»
            animateCounter();
        }
        
        // è®¡æ•°å™¨åŠ¨ç”»
        function animateCounter() {
            const counter = document.querySelector('.blessing-counter');
            counter.style.animation = 'none';
            setTimeout(() => {
                counter.style.animation = 'counterPulse 0.5s ease';
            }, 10);
        }
        
        // åˆå§‹åŒ–éŸ³é¢‘
        function initAudio() {
            try {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
                console.log("éŸ³é¢‘ä¸Šä¸‹æ–‡åˆå§‹åŒ–æˆåŠŸ");
            } catch (e) {
                console.log("æµè§ˆå™¨ä¸æ”¯æŒWeb Audio APIï¼Œå£°éŸ³åŠŸèƒ½å°†è¢«ç¦ç”¨");
                isSoundEnabled = false;
                soundStatus.textContent = "ä¸æ”¯æŒ ğŸ”Š";
                toggleSoundBtn.disabled = true;
                toggleSoundBtn.textContent = "å£°éŸ³ä¸æ”¯æŒ";
            }
        }

        // æ’­æ”¾å£°éŸ³å‡½æ•°
        function playSound(frequency, type = 'sine', duration = 0.5) {
            if (!isSoundEnabled || !audioContext) return;
            
            try {
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.value = frequency;
                oscillator.type = type;
                
                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + duration);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + duration);
            } catch (e) {
                console.log("æ’­æ”¾å£°éŸ³æ—¶å‡ºé”™:", e);
            }
        }

        // æ’­æ”¾æ°‘æ—ä¹å™¨é£æ ¼å£°éŸ³
        function playInstrumentSound(noteIndex, instrumentType) {
            if (!isSoundEnabled) return;
            
            const baseFreq = 261.63;
            const instrumentMultipliers = {
                'guzheng': [1, 1.122, 1.26, 1.335, 1.498, 1.682, 1.888, 2],
                'pipa': [1, 1.059, 1.122, 1.189, 1.26, 1.335, 1.414, 1.498],
                'dizi': [1, 1.059, 1.122, 1.189, 1.26, 1.335, 1.414, 1.498],
                'erhu': [1, 1.059, 1.122, 1.189, 1.26, 1.335, 1.414, 1.498],
                'bell': [1, 1.26, 1.498, 1.682, 2]
            };
            
            const instrument = instrumentMultipliers[instrumentType] || instrumentMultipliers['guzheng'];
            const freqIndex = noteIndex % instrument.length;
            const frequency = baseFreq * instrument[freqIndex];
            
            const waveTypes = {
                'guzheng': 'sine',
                'pipa': 'square',
                'dizi': 'sine',
                'erhu': 'sawtooth',
                'bell': 'sine'
            };
            
            const waveType = waveTypes[instrumentType] || 'sine';
            
            const durations = {
                'guzheng': isMobile ? 0.7 : 1.0,
                'pipa': isMobile ? 0.5 : 0.7,
                'dizi': isMobile ? 0.6 : 0.8,
                'erhu': isMobile ? 0.9 : 1.2,
                'bell': isMobile ? 1.5 : 2.0
            };
            
            const duration = durations[instrumentType] || 0.5;
            
            playSound(frequency, waveType, duration);
        }

        // èŠ‚æ—¥å…ƒç´ å®šä¹‰
        const festivalElements = [
            { type: 'redEnvelope', char: 'ğŸ§§', color: '#D32F2F', instrument: 'guzheng', sizeMultiplier: isMobile ? 1.2 : 1.5 },
            { type: 'fuCharacter', char: 'ç¦', color: '#FFD700', instrument: 'bell', sizeMultiplier: isMobile ? 1.4 : 1.8 },
            { type: 'lantern', char: 'ğŸ®', color: '#FF5722', instrument: 'pipa', sizeMultiplier: isMobile ? 1.3 : 1.6 },
            { type: 'firecracker', char: 'ğŸ†', color: '#FF9800', instrument: 'dizi', sizeMultiplier: isMobile ? 1.1 : 1.4 },
            { type: 'goldIngot', char: 'ğŸ’°', color: '#FFD700', instrument: 'erhu', sizeMultiplier: isMobile ? 1.2 : 1.5 },
            { type: 'springCouplet', char: 'ğŸ“œ', color: '#000000', instrument: 'guzheng', sizeMultiplier: isMobile ? 1.4 : 1.7 },
            { type: 'orange', char: 'ğŸŠ', color: '#FF9800', instrument: 'pipa', sizeMultiplier: isMobile ? 1.0 : 1.3 },
            { type: 'chineseKnot', char: 'ğŸ€', color: '#D32F2F', instrument: 'dizi', sizeMultiplier: isMobile ? 1.1 : 1.4 },
            { type: 'dumpling', char: 'ğŸ¥Ÿ', color: '#FFFFFF', instrument: 'erhu', sizeMultiplier: isMobile ? 1.0 : 1.3 },
            { type: 'moon', char: 'ğŸ‘', color: '#FFEB3B', instrument: 'bell', sizeMultiplier: isMobile ? 1.3 : 1.6 }
        ];

        // å–œåº†ç¥ç¦è¯­æ•°ç»„
        const blessings = [
            "ğŸ‰ æ–°å¹´å¿«ä¹ ğŸ‰", "ğŸŠ ä¸‡äº‹å¦‚æ„ ğŸŠ", "ğŸ’° æ­å–œå‘è´¢ ğŸ’°", "ğŸ å²å²å¹³å®‰ ğŸ", 
            "ğŸ  é˜–å®¶æ¬¢ä¹ ğŸ ", "ğŸ’ª èº«ä½“å¥åº· ğŸ’ª", "ğŸ‰ é¾™é©¬ç²¾ç¥ ğŸ‰", "ğŸŒˆ å‰ç¥¥å¦‚æ„ ğŸŒˆ",
            "âœ¨ å¿ƒæƒ³äº‹æˆ âœ¨", "ğŸª™ äº”ç¦ä¸´é—¨ ğŸª™", "ğŸ’¸ è´¢æºå¹¿è¿› ğŸ’¸", "â˜€ï¸ ç¦æ˜Ÿé«˜ç…§ â˜€ï¸",
            "ğŸŸ å¹´å¹´æœ‰ä½™ ğŸŸ", "ğŸ“ˆ æ­¥æ­¥é«˜å‡ ğŸ“ˆ", "ğŸ˜„ ç¬‘å£å¸¸å¼€ ğŸ˜„", "â¤ï¸ å¹¸ç¦ç¾æ»¡ â¤ï¸"
        ];

        // å–œåº†æ–‡å­—é¢œè‰²
        const blessingColors = ['#FF0000', '#FFD700', '#FF6B6B', '#4CAF50', '#2196F3', '#9C27B0', '#FF9800', '#00BCD4'];

        // å­˜å‚¨æ´»è·ƒçš„å…ƒç´ 
        const activeElements = [];
        const maxElements = isMobile ? 60 : 120;

        // èƒŒæ™¯é¢œè‰²
        let bgColors = [
            { primary: '#8B0000', secondary: '#B22222' },
            { primary: '#0A2E5C', secondary: '#1A4B8C' },
            { primary: '#1B5E20', secondary: '#2E7D32' },
            { primary: '#4A148C', secondary: '#6A1B9A' },
            { primary: '#B71C1C', secondary: '#D32F2F' },
            { primary: '#E65100', secondary: '#FF6F00' }
        ];
        let currentBgIndex = 0;

        // æ˜¾ç¤º/éšè—ä½¿ç”¨è¯´æ˜
        function toggleInstructions(show) {
            if (show) {
                instructionsPanel.classList.add('show');
                showInstructionsBtn.textContent = "ğŸ“– éšè—è¯´æ˜";
            } else {
                instructionsPanel.classList.remove('show');
                showInstructionsBtn.textContent = "ğŸ“– æ˜¾ç¤ºè¯´æ˜";
            }
        }
        
        // æ˜¾ç¤º/éšè—ç»Ÿè®¡é¢æ¿
        function toggleStatsPanel(show) {
            if (show === undefined) {
                show = !statsPanel.classList.contains('show');
            }
            
            if (show) {
                statsPanel.classList.add('show');
                showStatsBtn.textContent = "ğŸ“Š éšè—ç»Ÿè®¡";
            } else {
                statsPanel.classList.remove('show');
                showStatsBtn.textContent = "ğŸ“Š æ˜¾ç¤ºç»Ÿè®¡";
            }
        }

        // ç»˜åˆ¶èŠ‚æ—¥å…ƒç´ 
        function drawFestivalElement(x, y, elementIndex, keyIndex, isTouch = false) {
            if (activeElements.length >= maxElements) {
                activeElements.shift();
            }
            
            const elementTypeIndex = elementIndex % festivalElements.length;
            const element = festivalElements[elementTypeIndex];
            
            // å¢åŠ ç¥ç¦è®¡æ•°
            addBlessingCount(element.type);
            
            const baseSize = isMobile ? 
                (40 + (keyIndex % 5) * 8) : 
                (70 + (keyIndex % 7) * 15);
                
            const size = baseSize * element.sizeMultiplier;
            
            const blessing = blessings[Math.floor(Math.random() * blessings.length)];
            const blessingColor = blessingColors[Math.floor(Math.random() * blessingColors.length)];
            
            const newElement = {
                x, y,
                size: isTouch ? size * 0.8 : size,
                type: element.type,
                char: element.char,
                color: element.color,
                instrument: element.instrument,
                blessing: blessing,
                blessingColor: blessingColor,
                opacity: 1,
                life: isTouch ? (80 + Math.random() * 60) : (120 + Math.random() * 100),
                rotation: Math.random() * 360,
                rotationSpeed: (Math.random() - 0.5) * (isMobile ? 2 : 3),
                velocityX: (Math.random() - 0.5) * (isMobile ? 1.5 : 2.5),
                velocityY: (Math.random() - 0.5) * (isMobile ? 1.5 : 2) - (isMobile ? 1.5 : 2.5),
                createdAt: Date.now(),
                scale: 1,
                scaleDirection: Math.random() > 0.5 ? 1 : -1
            };
            
            activeElements.push(newElement);
            
            if (isSoundEnabled) {
                playInstrumentSound(keyIndex, element.instrument);
            }
            
            createFirework(x, y, element.color, isTouch);
        }

        // åˆ›å»ºçƒŸèŠ±æ•ˆæœ
        function createFirework(x, y, color, isTouch = false) {
            const particles = isTouch ? 10 : 16;
            
            for (let i = 0; i < particles; i++) {
                const angle = (i / particles) * Math.PI * 2;
                const velocity = isTouch ? (2 + Math.random() * 3) : (3 + Math.random() * 4);
                
                const particle = {
                    x, y,
                    velocityX: Math.cos(angle) * velocity,
                    velocityY: Math.sin(angle) * velocity,
                    size: isTouch ? (3 + Math.random() * 4) : (4 + Math.random() * 6),
                    color: color,
                    life: isTouch ? 25 : 40
                };
                
                activeElements.push(particle);
            }
        }

        // ç»˜åˆ¶æ‰€æœ‰å…ƒç´ 
        function draw() {
            const bgColor = bgColors[currentBgIndex];
            const gradient = ctx.createRadialGradient(
                canvas.width / 2, canvas.height / 2, 0,
                canvas.width / 2, canvas.height / 2, Math.max(canvas.width, canvas.height) / 2
            );
            gradient.addColorStop(0, bgColor.primary);
            gradient.addColorStop(1, bgColor.secondary);
            
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            drawBackgroundDecorations();
            
            for (let i = 0; i < activeElements.length; i++) {
                const element = activeElements[i];
                
                element.x += element.velocityX || 0;
                element.y += element.velocityY || 0;
                element.rotation += element.rotationSpeed || 0;
                element.life -= 1;
                
                if (element.scale !== undefined) {
                    element.scale += 0.01 * element.scaleDirection;
                    if (element.scale > 1.2) element.scaleDirection = -1;
                    if (element.scale < 0.9) element.scaleDirection = 1;
                }
                
                if (element.life < 60) {
                    element.opacity = element.life / 60;
                }
                
                if (element.life <= 0) {
                    activeElements.splice(i, 1);
                    i--;
                    continue;
                }
                
                ctx.globalAlpha = element.opacity;
                
                if (element.type) {
                    drawElement(element);
                } else {
                    drawParticle(element);
                }
            }
            
            ctx.globalAlpha = 1;
        }

        // ç»˜åˆ¶èƒŒæ™¯è£…é¥°
        function drawBackgroundDecorations() {
            const lanternCount = isMobile ? 6 : 10;
            const now = Date.now();
            
            for (let i = 0; i < lanternCount; i++) {
                const x = (canvas.width / (lanternCount + 1)) * (i + 1);
                const y = 40 + Math.sin(now / 800 + i) * (isMobile ? 12 : 20);
                const size = isMobile ? 40 : 60;
                
                ctx.fillStyle = 'rgba(255, 87, 34, 0.2)';
                ctx.beginPath();
                ctx.ellipse(x, y, size/2, size, 0, 0, Math.PI * 2);
                ctx.fill();
                
                ctx.fillStyle = 'rgba(255, 193, 7, 0.3)';
                ctx.fillRect(x - size/2.5, y - size - 5, size/1.25, 5);
                ctx.fillRect(x - size/2.5, y + size, size/1.25, 5);
                
                if (!isMobile) {
                    ctx.strokeStyle = 'rgba(255, 193, 7, 0.3)';
                    ctx.lineWidth = 2;
                    ctx.beginPath();
                    ctx.moveTo(x, y + size + 5);
                    for (let j = 0; j < 5; j++) {
                        const sx = x - size/2.5 + (j * size/5);
                        ctx.lineTo(sx, y + size + 20);
                    }
                    ctx.stroke();
                }
                
                ctx.fillStyle = 'rgba(255, 215, 0, 0.6)';
                ctx.font = `bold ${size * 0.3}px 'Ma Shan Zheng', cursive`;
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText('ç¦', x, y);
            }
        }

        // ç»˜åˆ¶èŠ‚æ—¥å…ƒç´ 
        function drawElement(element) {
            ctx.save();
            ctx.translate(element.x, element.y);
            
            const scale = element.scale || 1;
            ctx.scale(scale, scale);
            
            ctx.rotate(element.rotation * Math.PI / 180);
            
            ctx.fillStyle = element.color + Math.floor(element.opacity * 255).toString(16).padStart(2, '0');
            
            const size = element.size;
            switch(element.type) {
                case 'redEnvelope':
                    ctx.fillRect(-size/2, -size/2, size, size);
                    ctx.fillStyle = '#FFD700' + Math.floor(element.opacity * 200).toString(16).padStart(2, '0');
                    ctx.fillRect(-size/2, -size/2, size, size/3);
                    break;
                case 'fuCharacter':
                    ctx.fillStyle = '#D32F2F' + Math.floor(element.opacity * 255).toString(16).padStart(2, '0');
                    ctx.fillRect(-size/2, -size/2, size, size);
                    ctx.fillStyle = '#FFD700' + Math.floor(element.opacity * 255).toString(16).padStart(2, '0');
                    ctx.font = `bold ${size * (isMobile ? 0.7 : 0.9)}px 'Ma Shan Zheng', cursive`;
                    ctx.textAlign = 'center';
                    ctx.textBaseline = 'middle';
                    ctx.fillText(element.char, 0, 0);
                    break;
                case 'lantern':
                    ctx.fillStyle = element.color + Math.floor(element.opacity * 255).toString(16).padStart(2, '0');
                    ctx.beginPath();
                    ctx.ellipse(0, 0, size/2, size, 0, 0, Math.PI * 2);
                    ctx.fill();
                    break;
                default:
                    ctx.beginPath();
                    ctx.arc(0, 0, size/2, 0, Math.PI * 2);
                    ctx.fill();
            }
            
            ctx.fillStyle = '#FFFFFF' + Math.floor(element.opacity * 255).toString(16).padStart(2, '0');
            ctx.font = `bold ${size * (isMobile ? 0.5 : 0.7)}px Arial, sans-serif`;
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText(element.char, 0, 0);
            
            if (size > (isMobile ? 30 : 40)) {
                const blessingSize = Math.max(size * (isMobile ? 0.25 : 0.35), isMobile ? 16 : 24);
                ctx.font = `bold ${blessingSize}px 'ZCOOL QingKe HuangYou', cursive`;
                ctx.fillStyle = element.blessingColor + Math.floor(element.opacity * 255).toString(16).padStart(2, '0');
                
                if (!isMobile) {
                    ctx.shadowColor = 'rgba(0, 0, 0, 0.7)';
                    ctx.shadowBlur = 10;
                    ctx.shadowOffsetX = 2;
                    ctx.shadowOffsetY = 2;
                }
                
                ctx.fillText(element.blessing, 0, size * (isMobile ? 0.7 : 0.8));
                
                if (!isMobile) {
                    ctx.shadowColor = 'transparent';
                    ctx.shadowBlur = 0;
                    ctx.shadowOffsetX = 0;
                    ctx.shadowOffsetY = 0;
                }
            }
            
            ctx.restore();
        }

        // ç»˜åˆ¶çƒŸèŠ±ç²’å­
        function drawParticle(particle) {
            ctx.fillStyle = particle.color + Math.floor((particle.life / (isMobile ? 25 : 40)) * 255).toString(16).padStart(2, '0');
            ctx.beginPath();
            ctx.arc(particle.x, particle.y, particle.size, 0, Math.PI * 2);
            ctx.fill();
        }

        // åŠ¨ç”»å¾ªç¯
        function animate() {
            draw();
            requestAnimationFrame(animate);
        }

        // è®¾ç½®äº‹ä»¶ç›‘å¬
        function setupEventListeners() {
            // æ˜¾ç¤º/éšè—ä½¿ç”¨è¯´æ˜
            showInstructionsBtn.addEventListener('click', function() {
                const isShowing = instructionsPanel.classList.contains('show');
                toggleInstructions(!isShowing);
                // éšè—ç»Ÿè®¡é¢æ¿
                if (statsPanel.classList.contains('show')) {
                    toggleStatsPanel(false);
                }
            });
            
            closeInstructionsBtn.addEventListener('click', function() {
                toggleInstructions(false);
            });
            
            // æ˜¾ç¤º/éšè—ç»Ÿè®¡é¢æ¿
            showStatsBtn.addEventListener('click', function() {
                toggleStatsPanel();
                // éšè—è¯´æ˜é¢æ¿
                if (instructionsPanel.classList.contains('show')) {
                    toggleInstructions(false);
                }
            });
            
            // é”®ç›˜äº‹ä»¶
            document.addEventListener('keydown', function(e) {
                if (e.key === ' ') {
                    activeElements.length = 0;
                    return;
                }
                
                if (e.key === 'F1') {
                    e.preventDefault();
                    const isShowing = instructionsPanel.classList.contains('show');
                    toggleInstructions(!isShowing);
                    return;
                }
                
                if (e.key === 'F2') {
                    e.preventDefault();
                    toggleStatsPanel();
                    return;
                }
                
                if (e.key.length !== 1) return;
                
                const keyIndex = e.key.toLowerCase().charCodeAt(0) - 97;
                if (keyIndex >= 0 && keyIndex < 26) {
                    const x = Math.max(100, Math.random() * (canvas.width - 100));
                    const y = Math.max(100, Math.random() * (canvas.height - 100));
                    drawFestivalElement(x, y, keyIndex, keyIndex);
                }
            });
            
            // é¼ æ ‡äº‹ä»¶
            let isDragging = false;
            
            canvas.addEventListener('mousedown', function(e) {
                if (isMobile) return;
                isDragging = true;
                handleInteraction(e.clientX, e.clientY);
            });
            
            canvas.addEventListener('mousemove', function(e) {
                if (isMobile || !isDragging) return;
                handleInteraction(e.clientX, e.clientY);
            });
            
            canvas.addEventListener('mouseup', function() {
                if (isMobile) return;
                isDragging = false;
            });
            
            canvas.addEventListener('mouseleave', function() {
                if (isMobile) return;
                isDragging = false;
            });
            
            // è§¦æ‘¸äº‹ä»¶
            let lastTouchTime = 0;
            let touchMoveTimeout = null;
            
            canvas.addEventListener('touchstart', function(e) {
                e.preventDefault();
                const touch = e.touches[0];
                handleInteraction(touch.clientX, touch.clientY, true);
                lastTouchTime = Date.now();
            }, { passive: false });
            
            canvas.addEventListener('touchmove', function(e) {
                e.preventDefault();
                const now = Date.now();
                if (now - lastTouchTime > 50) {
                    const touch = e.touches[0];
                    handleInteraction(touch.clientX, touch.clientY, true);
                    lastTouchTime = now;
                }
                
                if (touchMoveTimeout) {
                    clearTimeout(touchMoveTimeout);
                }
                
                touchMoveTimeout = setTimeout(() => {
                    const touch = e.touches[0];
                    handleInteraction(touch.clientX, touch.clientY, true);
                }, 100);
            }, { passive: false });
            
            canvas.addEventListener('touchend', function(e) {
                e.preventDefault();
                if (touchMoveTimeout) {
                    clearTimeout(touchMoveTimeout);
                    touchMoveTimeout = null;
                }
            }, { passive: false });
            
            // çª—å£è°ƒæ•´å¤§å°
            window.addEventListener('resize', function() {
                resizeCanvas();
            });
            
            // æ§åˆ¶æŒ‰é’®äº‹ä»¶
            clearBtn.addEventListener('click', function() {
                activeElements.length = 0;
            });
            
            toggleSoundBtn.addEventListener('click', function() {
                isSoundEnabled = !isSoundEnabled;
                soundStatus.textContent = isSoundEnabled ? "å¼€å¯ ğŸ”Š" : "å…³é—­ ğŸ”‡";
                toggleSoundBtn.textContent = isSoundEnabled ? "å…³é—­å£°éŸ³ ğŸ”‡" : "å¼€å¯å£°éŸ³ ğŸ”Š";
                
                if (isSoundEnabled && audioContext && audioContext.state === 'suspended') {
                    audioContext.resume();
                }
            });
            
            changeBgBtn.addEventListener('click', function() {
                currentBgIndex = (currentBgIndex + 1) % bgColors.length;
            });
            
            resetStatsBtn.addEventListener('click', resetStats);
            
            // åŒå‡»äº‹ä»¶ - å¿«é€Ÿç”Ÿæˆå¤šä¸ªå…ƒç´ 
            let lastClickTime = 0;
            canvas.addEventListener('click', function(e) {
                if (isMobile) return;
                
                const now = Date.now();
                if (now - lastClickTime < 300) {
                    for (let i = 0; i < 3; i++) {
                        const rect = canvas.getBoundingClientRect();
                        const x = e.clientX - rect.left + (Math.random() - 0.5) * 100;
                        const y = e.clientY - rect.top + (Math.random() - 0.5) * 100;
                        const elementIndex = Math.floor(Math.random() * festivalElements.length);
                        const keyIndex = Math.floor(Math.random() * 26);
                        drawFestivalElement(x, y, elementIndex, keyIndex);
                    }
                } else {
                    const rect = canvas.getBoundingClientRect();
                    const x = e.clientX - rect.left;
                    const y = e.clientY - rect.top;
                    const elementIndex = Math.floor(Math.random() * festivalElements.length);
                    const keyIndex = Math.floor(Math.random() * 26);
                    drawFestivalElement(x, y, elementIndex, keyIndex);
                }
                lastClickTime = now;
            });
        }
        
        // å¤„ç†äº¤äº’
        function handleInteraction(clientX, clientY, isTouch = false) {
            const rect = canvas.getBoundingClientRect();
            const x = clientX - rect.left;
            const y = clientY - rect.top;
            const elementIndex = Math.floor(Math.random() * festivalElements.length);
            const keyIndex = Math.floor(Math.random() * 26);
            drawFestivalElement(x, y, elementIndex, keyIndex, isTouch);
        }

        // åˆå§‹åŒ–
        function init() {
            console.log(`è®¾å¤‡ç±»å‹: ${isMobile ? 'ç§»åŠ¨è®¾å¤‡' : 'æ¡Œé¢è®¾å¤‡'}`);
            
            initAudio();
            setupEventListeners();
            animate();
            
            // é»˜è®¤ä¸æ˜¾ç¤ºä½¿ç”¨è¯´æ˜
            toggleInstructions(false);
            
            // åŠ è½½ç»Ÿè®¡æ•°æ®
            loadStats();
            
            // åˆå§‹æ˜¾ç¤ºä¸€äº›å…ƒç´ 
            for (let i = 0; i < (isMobile ? 4 : 8); i++) {
                const x = Math.max(50, Math.random() * (canvas.width - 50));
                const y = Math.max(50, Math.random() * (canvas.height - 50));
                const elementIndex = Math.floor(Math.random() * festivalElements.length);
                const keyIndex = Math.floor(Math.random() * 26);
                drawFestivalElement(x, y, elementIndex, keyIndex);
            }
            
            console.log("ä¸­åèŠ‚æ—¥éŸ³ç”»å·²åˆå§‹åŒ–å®Œæˆï¼");
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        window.addEventListener('load', init);
    </script>
</body>
</html>