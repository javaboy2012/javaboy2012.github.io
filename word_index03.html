<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WordStory - ç‹—è¡€å‰§æƒ…é˜…è¯»å™¨</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary: #f43f5e;
            --primary-grad: linear-gradient(135deg, #f43f5e, #fb7185);
            --bg: #fff1f2;
            --tag-green-bg: #dcfce7; --tag-green-text: #166534;
            --tag-red-bg: #fee2e2; --tag-red-text: #991b1b;
        }
        body { font-family: 'PingFang SC', system-ui, sans-serif; margin: 0; background: var(--bg); color: #1e293b; }
        .navbar { background: white; padding: 1rem 5%; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 1px 3px rgba(0,0,0,0.1); position: sticky; top: 0; z-index: 1000; }
        .nav-links span { margin-left: 2rem; cursor: pointer; font-weight: 500; color: #64748b; }
        .nav-links span.active { color: var(--primary); position: relative; }
        .nav-links span.active::after { content: ''; position: absolute; bottom: -8px; left: 0; width: 100%; height: 3px; background: var(--primary); border-radius: 2px; }
        .view { display: none; padding: 2rem 5%; max-width: 1200px; margin: 0 auto; animation: fadeIn 0.3s ease; }
        .view.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .hero { background: var(--primary-grad); color: white; padding: 3rem; border-radius: 2rem; text-align: center; margin-bottom: 2rem; }
        .stat-banner { display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem; margin-top: 2rem; }
        .stat-item { background: rgba(255,255,255,0.15); padding: 1rem; border-radius: 1rem; backdrop-filter: blur(10px); }
        .features { display: grid; grid-template-columns: repeat(3, 1fr); gap: 1.5rem; margin-bottom: 3rem; }
        .feature-card { background: white; padding: 1.5rem; border-radius: 1.2rem; text-align: center; border: 1px dashed #fecdd3; }
        .feature-card i { font-size: 2rem; color: var(--primary); margin-bottom: 1rem; }
        .feature-card h4 { margin: 10px 0; color: #1e293b; }
        .feature-card p { font-size: 0.9rem; color: #64748b; line-height: 1.5; }
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 1.5rem; }
        .card { background: white; padding: 1.5rem; border-radius: 1.2rem; box-shadow: 0 4px 6px rgba(0,0,0,0.05); transition: 0.3s; cursor: pointer; border: 1px solid transparent; }
        .card:hover { transform: translateY(-5px); border-color: var(--primary); }
        .pagination { display: flex; justify-content: center; gap: 0.5rem; margin-top: 2rem; }
        .page-btn { padding: 8px 16px; border: 1px solid #e2e8f0; background: white; border-radius: 8px; cursor: pointer; }
        .page-btn.active { background: var(--primary); color: white; border-color: var(--primary); }
        .study-controls { display: flex; justify-content: flex-start; align-items: center; margin-bottom: 1.5rem; }
        .mode-selector { display: flex; gap: 8px; background: #e2e8f0; padding: 4px; border-radius: 10px; width: fit-content; }
        .mode-btn { border: none; padding: 6px 16px; border-radius: 8px; cursor: pointer; background: transparent; transition: 0.2s; }
        .mode-btn.active { background: white; color: var(--primary); box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .story-layout { display: grid; grid-template-columns: 1fr 350px; gap: 2rem; }
        .story-paper { background: white; padding: 2.5rem; border-radius: 1.5rem; line-height: 2.3; font-size: 1.2rem; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
        .word-tag { display: inline-block; padding: 0 6px; border-radius: 4px; margin: 0 2px; font-weight: 600; cursor: pointer; transition: 0.2s; }
        .tag-a { background: var(--tag-green-bg); color: var(--tag-green-text); }
        .tag-b { background: var(--tag-red-bg); color: var(--tag-red-text); }
        .word-tag.mastered { opacity: 0.3; text-decoration: line-through; }
        .calendar { display: grid; grid-template-columns: repeat(7, 1fr); gap: 6px; }
        .cal-day { aspect-ratio: 1; background: #e2e8f0; border-radius: 6px; display: flex; align-items: center; justify-content: center; font-size: 12px; color: #94a3b8; }
        .cal-day.active { background: #10b981; color: white; }
        .btn { padding: 10px 20px; border-radius: 10px; border: none; cursor: pointer; font-weight: 600; transition: 0.3s; display: inline-flex; align-items: center; gap: 8px; }
        .btn-primary { background: var(--primary); color: white; }
        .done-list { margin-top: 1.5rem; list-style: none; padding: 0; }
        .done-item { background: white; padding: 1rem; border-radius: 10px; margin-bottom: 0.8rem; display: flex; align-items: center; gap: 15px; box-shadow: 0 2px 4px rgba(0,0,0,0.03); }
    </style>
</head>
<body>

    <nav class="navbar">
        <div style="font-size: 1.5rem; font-weight: bold; color: var(--primary);">WordStory â¤ï¸</div>
        <div class="nav-links">
            <span id="nav-home" class="active" onclick="switchView('home')">é¦–é¡µ</span>
            <span id="nav-lib" onclick="switchView('lib')">æ•…äº‹åº“</span>
            <span id="nav-stats" onclick="switchView('stats')">å­¦ä¹ è®°å½•</span>
        </div>
    </nav>

    <div id="view-home" class="view active">
        <div class="hero">
            <h1>éœ¸æ€»å¸¦ä½ èƒŒå•è¯</h1>
            <p>æ‹’ç»æ¯ç‡¥ï¼Œåœ¨ç‹—è¡€å‰§æƒ…ä¸­ä¸çŸ¥ä¸è§‰æŒæ¡ç”Ÿè¯</p>
            <div class="stat-banner">
                <div class="stat-item">æŒæ¡å•è¯<h2 id="h-words">0</h2></div>
                <div class="stat-item">å®Œæˆæ•…äº‹<h2 id="h-stories">0</h2></div>
                <div class="stat-item">å­¦ä¹ å¤©æ•°<h2 id="h-days">0</h2></div>
            </div>
        </div>
        <div class="features">
            <div class="feature-card"><i class="fas fa-book-open"></i><h4>æ²‰æµ¸å‰§æƒ…</h4><p>ç²¾é€‰è¨€æƒ…ã€ç„å¹»ã€é‡ç”Ÿç­‰è¶£å‘³é¢˜æã€‚</p></div>
            <div class="feature-card"><i class="fas fa-magic"></i><h4>ä¸‰ç§æ¨¡å¼</h4><p>ä¸­æ–‡æ ‡ç­¾ã€è‹±æ–‡ã€ä¸­è‹±å¯¹ç…§è‡ªç”±åˆ‡æ¢ã€‚</p></div>
            <div class="feature-card"><i class="fas fa-calendar-check"></i><h4>å®æ—¶åé¦ˆ</h4><p>å¯è§†åŒ–è¶‹åŠ¿å›¾ä¸æ‰“å¡æ—¥å†è®°å½•è¿›æ­¥ã€‚</p></div>
        </div>
        <h2><i class="fas fa-fire" style="color:var(--primary)"></i> çƒ­é—¨è¿è½½æ¨è</h2>
        <div class="grid" id="home-rec-grid"></div>
    </div>

    <div id="view-lib" class="view">
        <div style="display:flex; gap:1rem; margin-bottom:1.5rem;">
            <input type="text" id="libSearch" placeholder="æœç´¢ç‹—è¡€å‰§æƒ…..." style="flex:1; padding:12px; border:none; border-radius:10px; outline:none;" oninput="renderLib(1)">
        </div>
        <div id="lib-grid" class="grid"></div>
        <div id="pagination" class="pagination"></div>
    </div>

    <div id="view-study" class="view">
        <div class="study-controls">
            <div class="mode-selector">
                <button class="mode-btn active" id="m-cn" onclick="setStudyMode('cn')">æ˜¾ç¤ºä¸­æ–‡</button>
                <button class="mode-btn" id="m-en" onclick="setStudyMode('en')">æ˜¾ç¤ºè‹±æ–‡</button>
                <button class="mode-btn" id="m-mix" onclick="setStudyMode('mix')">ä¸­è‹±å¯¹ç…§</button>
            </div>
        </div>
        <div class="story-layout">
            <div class="story-paper">
                <h2 id="s-title" style="margin-top:0"></h2>
                <div id="s-body"></div>
                <button class="btn btn-primary" style="margin-top:2rem; width:100%; justify-content: center;" onclick="finishStory()">æ ‡è®°æœ¬ç¯‡è¿½å®Œ</button>
            </div>
            <div id="s-detail" class="card" style="position:sticky; top:100px; text-align:center; height: fit-content; min-height: 200px;">
                <p style="color:#94a3b8">ç‚¹å‡»å½©è‰²æ ‡ç­¾æŸ¥çœ‹è¯¦æƒ…</p>
            </div>
        </div>
    </div>

    <div id="view-stats" class="view">
        <div style="display:grid; grid-template-columns: 2fr 1fr; gap:2rem;">
            <div>
                <div class="card"><h3>å­¦ä¹ è¶‹åŠ¿</h3><canvas id="statChart" height="150"></canvas></div>
                <div style="margin-top:2rem"><h3>ğŸ“– å·²è¿½å®Œçš„æ•…äº‹åˆ—è¡¨</h3><div id="done-list-container" class="done-list"></div></div>
            </div>
            <div class="card"><h3>æ‰“å¡æ—¥å† (2026å¹´1æœˆ)</h3><div id="cal-grid" class="calendar"></div></div>
        </div>
    </div>

    <script>
        const wordsPool = {
            arrogant: {en:"arrogant", cn:"å‚²æ…¢", type:"a", p:"/ËˆÃ¦rÉ™É¡É™nt/", e:"The CEO is so arrogant."},
            dominate: {en:"dominate", cn:"éœ¸å ", type:"a", p:"/ËˆdÉ’mÉªneÉªt/", e:"He wants to dominate the market."},
            fragile: {en:"fragile", cn:"è„†å¼±", type:"b", p:"/ËˆfrÃ¦dÊ’aÉªl/", e:"Her heart is so fragile."},
            destiny: {en:"destiny", cn:"å‘½è¿", type:"b", p:"/ËˆdestÉªni/", e:"It is our destiny to meet."},
            immortal: {en:"immortal", cn:"é•¿ç”Ÿä¸è€", type:"a", p:"/ÉªËˆmÉ”Ëtl/", e:"The cultivator sought immortal life."},
            betray: {en:"betray", cn:"èƒŒå›", type:"b", p:"/bÉªËˆtreÉª/", e:"Never betray my trust."},
            gorgeous: {en:"gorgeous", cn:"åä¸½/æç¾", type:"a", p:"/ËˆÉ¡É”ËdÊ’É™s/", e:"She looks gorgeous tonight."},
            revenge: {en:"revenge", cn:"å¤ä»‡", type:"b", p:"/rÉªËˆvendÊ’/", e:"Revenge is a dish best served cold."},
            mystic: {en:"mystic", cn:"ç¥ç§˜çš„", type:"a", p:"/ËˆmÉªstÉªk/", e:"A mystic sword appeared."},
            obsessed: {en:"obsessed", cn:"æ‰§è¿·çš„", type:"b", p:"/É™bËˆsest/", e:"He is obsessed with her."}
        };

        const storyDB = [
            { id: 1, title: "éœ¸æ€»ï¼šå¥³äººä½ åœ¨æƒ¹ç«", icon: "ğŸ’", template: "é‚£ä¸ª {arrogant} çš„ç”·äººä¸€æŠŠå°†å¥¹æŒ‰åœ¨å¢™ä¸Šï¼Œè¯•å›¾ {dominate} å¥¹çš„å…¨éƒ¨ç”Ÿæ´»ã€‚ä»–ä¸çŸ¥é“ï¼Œå¥¹çœ‹ä¼¼ {fragile} çš„å¤–è¡¨ä¸‹è—ç€ä¸€é¢—åšå®šçš„å¿ƒã€‚éš¾é“è¿™å°±æ˜¯å†¥å†¥ä¹‹ä¸­çš„ {destiny} å—ï¼Ÿ", words: { arrogant: wordsPool.arrogant, dominate: wordsPool.dominate, fragile: wordsPool.fragile, destiny: wordsPool.destiny } },
            { id: 2, title: "ä¿®ä»™ï¼šä¸€å‰‘æ–­ä¸‡å¤", icon: "âš”ï¸", template: "ä½œä¸ºå¯»æ‰¾ {immortal} ä¹‹è·¯çš„ä¿®è¡Œè€…ï¼Œä»–ä»æœªæƒ³è¿‡ä¼šè¢«æœ€äº²è¿‘çš„äºº {betray}ã€‚åœ¨è¿™ä¸ª {mystic} çš„ä¸–ç•Œé‡Œï¼Œå”¯æœ‰æ‰‹ä¸­çš„é•¿å‰‘èƒ½å¸®ä»–å®Œæˆè¿™åœº {revenge}ã€‚", words: { immortal: wordsPool.immortal, betray: wordsPool.betray, mystic: wordsPool.mystic, revenge: wordsPool.revenge } },
            { id: 3, title: "è±ªé—¨ï¼šé‡ç”Ÿä¹‹æˆ‘æ˜¯é˜”å¤ª", icon: "ğŸ¾", template: "é‡å›äºŒåå²ï¼Œå¥¹ç©¿ç€é‚£ä»¶ {gorgeous} çš„æ™šç¤¼æœå†æ¬¡æƒŠè‰³å…¨åœºã€‚æ›¾ç»å¯¹ä»– {obsessed} çš„å‰ä»»ï¼Œç°åœ¨åªèƒ½è·ªåœ¨åœ°ä¸Šæ±‚é¥¶ã€‚è¿™ä¸€ä¸–ï¼Œå¥¹è¦ä¸»å®°è‡ªå·±çš„ {destiny}ã€‚", words: { gorgeous: wordsPool.gorgeous, obsessed: wordsPool.obsessed, destiny: wordsPool.destiny } }
        ];

        for(let i=4; i<=20; i++) {
            storyDB.push({ id: i, title: `ç‹—è¡€ç³»åˆ— ç¬¬${i}è¯`, icon: "ğŸ”¥", template: "ç”Ÿæ´»å……æ»¡äº† {mystic} çš„è½¬æŠ˜ã€‚ä¸è¦å› ä¸ºä¸€æ—¶çš„ {betray} å°±æ„Ÿåˆ° {fragile}ï¼Œä½ è¦å˜å¾—æ›´åŠ  {arrogant} å»é¢å¯¹é‚£äº›ä¼¤å®³ä½ çš„äººã€‚", words: { mystic: wordsPool.mystic, betray: wordsPool.betray, fragile: wordsPool.fragile, arrogant: wordsPool.arrogant } });
        }

        // --- å®‰å…¨åˆå§‹åŒ–é€»è¾‘ ---
        let APP = {
            mastered: [],
            completed: [],
            days: [],
            mode: 'cn',
            currentPage: 1,
            currentStory: null
        };

        try {
            const savedM = localStorage.getItem('ws_m');
            const savedF = localStorage.getItem('ws_f');
            const savedD = localStorage.getItem('ws_d');
            if (savedM) APP.mastered = JSON.parse(savedM);
            if (savedF) APP.completed = JSON.parse(savedF);
            if (savedD) APP.days = JSON.parse(savedD);
        } catch (e) {
            console.error("Data Parse Error", e);
            localStorage.clear();
        }

        function switchView(v) {
            document.querySelectorAll('.view').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.nav-links span').forEach(el => el.classList.remove('active'));
            document.getElementById(`view-${v}`).classList.add('active');
            document.getElementById(`nav-${v}`).classList.add('active');
            if(v === 'home') renderHome();
            if(v === 'lib') renderLib(1);
            if(v === 'stats') renderStats();
            window.scrollTo(0,0);
        }

        function renderHome() {
            const grid = document.getElementById('home-rec-grid');
            grid.innerHTML = storyDB.slice(0, 3).map(s => `
                <div class="card" onclick="openStudy(${s.id})">
                    <span style="font-size:2.5rem">${s.icon}</span>
                    <h3 style="margin:10px 0">${s.title}</h3>
                </div>
            `).join('');
            updateStatsUI();
        }

        function renderLib(page) {
            APP.currentPage = page;
            const search = document.getElementById('libSearch').value.toLowerCase();
            const filtered = storyDB.filter(s => s.title.toLowerCase().includes(search));
            const perPage = 6;
            const start = (page - 1) * perPage;
            const paginated = filtered.slice(start, start + perPage);
            const grid = document.getElementById('lib-grid');
            grid.innerHTML = paginated.map(s => `
                <div class="card" onclick="openStudy(${s.id})">
                    <span style="font-size:2rem">${s.icon}</span>
                    <div style="flex:1">
                        <h3 style="margin:5px 0">${s.title} ${APP.completed.includes(s.id)?'âœ…':''}</h3>
                    </div>
                </div>
            `).join('');
            renderPagination(filtered.length, perPage, page);
        }

        function renderPagination(total, perPage, current) {
            const totalPages = Math.ceil(total / perPage);
            const container = document.getElementById('pagination');
            container.innerHTML = '';
            for(let i=1; i<=totalPages; i++) {
                container.innerHTML += `<button class="page-btn ${i===current?'active':''}" onclick="renderLib(${i})">${i}</button>`;
            }
        }

        function openStudy(id) {
            const story = storyDB.find(s => s.id === id);
            if(story) {
                APP.currentStory = story;
                APP.mode = 'cn';
                document.getElementById('s-detail').innerHTML = `<p style="color:#94a3b8">ç‚¹å‡»å½©è‰²æ ‡ç­¾æŸ¥çœ‹è¯¦æƒ…</p>`;
                document.querySelectorAll('.mode-btn').forEach(b => b.classList.remove('active'));
                document.getElementById('m-cn').classList.add('active');
                renderStudyContent();
                switchView('study');
            }
        }

        function setStudyMode(m) {
            APP.mode = m;
            document.querySelectorAll('.mode-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(`m-${m}`).classList.add('active');
            renderStudyContent();
        }

        function renderStudyContent() {
            if(!APP.currentStory) return;
            document.getElementById('s-title').innerText = APP.currentStory.title;
            let html = APP.currentStory.template;
            Object.keys(APP.currentStory.words).forEach(key => {
                const info = APP.currentStory.words[key];
                let display = (APP.mode === 'cn') ? info.cn : (APP.mode === 'en' ? info.en : `${info.en}(${info.cn})`);
                const isM = APP.mastered.includes(key) ? 'mastered' : '';
                const tagClass = info.type === 'a' ? 'tag-a' : 'tag-b';
                const regex = new RegExp(`\\{${key}\\}`, 'g');
                html = html.replace(regex, `<span class="word-tag ${tagClass} ${isM}" onclick="handleTagClick('${key}')">${display}</span>`);
            });
            document.getElementById('s-body').innerHTML = html;
        }

        function handleTagClick(key) { showDetail(key); speak(key); }

        function showDetail(key) {
            const info = APP.currentStory.words[key];
            const isM = APP.mastered.includes(key);
            document.getElementById('s-detail').innerHTML = `
                <h2 style="color:var(--primary);margin:0">${key}</h2>
                <p style="color:#94a3b8">${info.p}</p>
                <div style="text-align:left; background:#fdf2f2; padding:1rem; border-radius:10px; margin:1rem 0;">
                    <p><b>é‡Šä¹‰ï¼š</b>${info.cn}</p>
                    <p><b>ä¾‹å¥ï¼š</b><br><small>${info.e}</small></p>
                </div>
                <div style="display:flex; gap:10px;">
                    <button class="btn" style="flex:1; background:#fff; border:1px solid #ddd;" onclick="speak('${key}')"><i class="fas fa-volume-up"></i></button>
                    <button class="btn" style="flex:3; background:${isM?'#10b981':'#f43f5e'}; color:white;" onclick="toggleWord('${key}')">
                        ${isM?'å·²æŒæ¡':'æ ‡è®°æŒæ¡'}
                    </button>
                </div>
            `;
        }

        function speak(text) {
            window.speechSynthesis.cancel();
            const msg = new SpeechSynthesisUtterance(text);
            msg.lang = 'en-US';
            window.speechSynthesis.speak(msg);
        }

        function toggleWord(key) {
            if(APP.mastered.includes(key)) APP.mastered = APP.mastered.filter(k => k !== key);
            else { 
                APP.mastered.push(key);
                const today = new Date().toDateString();
                if(!APP.days.includes(today)) APP.days.push(today);
            }
            save(); renderStudyContent(); showDetail(key);
        }

        function finishStory() {
            if(!APP.completed.includes(APP.currentStory.id)) APP.completed.push(APP.currentStory.id);
            save(); alert("æœ¬è¯è¿½å®Œï¼Œå·²åŠ å…¥å®Œæˆåˆ—è¡¨ï¼"); switchView('lib');
        }

        function renderStats() {
            const grid = document.getElementById('cal-grid');
            if(!grid) return;
            grid.innerHTML = '';
            for(let i=1; i<=31; i++) {
                const d = new Date(2026, 0, i).toDateString();
                grid.innerHTML += `<div class="cal-day ${APP.days.includes(d)?'active':''}">${i}</div>`;
            }
            const ctx = document.getElementById('statChart').getContext('2d');
            new Chart(ctx, { type: 'line', data: { labels: ['Mon','Tue','Wed','Thu','Fri','Sat','Sun'], datasets: [{ label: 'å¿ƒåŠ¨è¯æ•°', data: [5, 12, 8, 15, 10, 20, APP.mastered.length], borderColor: '#f43f5e', tension: 0.4 }] } });
            
            const listContainer = document.getElementById('done-list-container');
            const completedStories = storyDB.filter(s => APP.completed.includes(s.id));
            listContainer.innerHTML = completedStories.length ? completedStories.map(s => `
                <div class="done-item" onclick="openStudy(${s.id})">
                    <span style="font-size:1.5rem">${s.icon}</span>
                    <div style="flex:1">
                        <div style="font-weight:600">${s.title}</div>
                        <div style="font-size:0.8rem; color:#94a3b8">é˜…è¯»çŠ¶æ€ï¼šå·²è¿½å®Œ âœ…</div>
                    </div>
                </div>
            `).join('') : '<p style="color:#94a3b8">è¿˜æ²¡æœ‰è¿½å®Œçš„æ•…äº‹...</p>';
        }

        function save() {
            localStorage.setItem('ws_m', JSON.stringify(APP.mastered));
            localStorage.setItem('ws_f', JSON.stringify(APP.completed));
            localStorage.setItem('ws_d', JSON.stringify(APP.days));
            updateStatsUI();
        }

        function updateStatsUI() {
            document.getElementById('h-words').innerText = APP.mastered.length;
            document.getElementById('h-stories').innerText = APP.completed.length;
            document.getElementById('h-days').innerText = APP.days.length;
        }

        window.onload = () => { renderHome(); updateStatsUI(); };
    </script>
</body>
</html>