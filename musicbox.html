<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å¥‡å¦™å¬éŸ³ç›’ - å„¿ç«¥è‹±è¯­å¯è’™æ¸¸æˆ</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Comic Sans MS', 'Chalkboard SE', 'å¹¼åœ†', sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            overflow-x: hidden;
        }

        .container {
            width: 100%;
            max-width: 800px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        /* å¤´éƒ¨åŒºåŸŸ */
        .header {
            text-align: center;
            margin-bottom: 25px;
            width: 100%;
        }

        .logo {
            font-size: 2.8rem;
            color: #6a5acd;
            margin-bottom: 10px;
            text-shadow: 3px 3px 0 #dda0dd;
        }

        .subtitle {
            font-size: 1.3rem;
            color: #7b68ee;
            margin-bottom: 15px;
        }

        /* æ¸¸æˆåŒºåŸŸ */
        .game-container {
            background: white;
            border-radius: 30px;
            box-shadow: 0 15px 35px rgba(106, 90, 205, 0.15);
            padding: 30px;
            width: 100%;
            margin-bottom: 25px;
            position: relative;
            overflow: hidden;
            border: 8px solid #e6e6fa;
        }

        /* å¬åŠ›åŒºåŸŸ */
        .listening-area {
            text-align: center;
            margin-bottom: 35px;
            padding: 20px;
            background: linear-gradient(120deg, #f0f8ff 0%, #e6e6fa 100%);
            border-radius: 25px;
            border: 5px dashed #9370db;
            position: relative;
            min-height: 180px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .sound-wave {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 15px;
            height: 60px;
        }

        .wave-bar {
            width: 8px;
            height: 20px;
            background: #9370db;
            margin: 0 4px;
            border-radius: 10px;
            animation: wave 1.2s ease-in-out infinite;
            animation-delay: calc(var(--i) * 0.1s);
        }

        @keyframes wave {
            0%, 100% { height: 20px; }
            50% { height: 50px; }
        }

        .instruction {
            font-size: 1.6rem;
            color: #483d8b;
            margin-bottom: 15px;
            font-weight: bold;
        }

        .word-display {
            font-size: 2.5rem;
            color: #4b0082;
            font-weight: bold;
            margin: 10px 0;
            min-height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* é€‰é¡¹åŒºåŸŸ */
        .options-area {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 25px;
            margin-bottom: 30px;
        }

        @media (max-width: 600px) {
            .options-area {
                grid-template-columns: 1fr;
                gap: 20px;
            }
        }

        .option {
            background: white;
            border-radius: 25px;
            padding: 25px 15px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 5px solid #d8bfd8;
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.08);
            position: relative;
            overflow: hidden;
        }

        .option:hover {
            transform: translateY(-8px);
            box-shadow: 0 15px 20px rgba(147, 112, 219, 0.2);
        }

        .option:active {
            transform: scale(0.97);
        }

        .option-img {
            width: 120px;
            height: 120px;
            object-fit: contain;
            margin-bottom: 15px;
            transition: all 0.3s ease;
        }

        .option-label {
            font-size: 1.4rem;
            color: #483d8b;
            font-weight: bold;
        }

        /* åé¦ˆæ•ˆæœ */
        .correct {
            border-color: #32cd32 !important;
            background: linear-gradient(135deg, #f0fff0 0%, #e0ffe0 100%) !important;
            animation: pulseCorrect 1.5s ease;
        }

        .incorrect {
            border-color: #ff6b6b !important;
            background: linear-gradient(135deg, #fff0f0 0%, #ffe0e0 100%) !important;
            animation: shake 0.5s ease;
        }

        .hint {
            border-color: #ffd700 !important;
            background: linear-gradient(135deg, #fffacd 0%, #fff8dc 100%) !important;
            animation: pulseHint 2s infinite;
        }

        @keyframes pulseCorrect {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }

        @keyframes pulseHint {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        /* æ§åˆ¶åŒºåŸŸ */
        .controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 18px 30px;
            font-size: 1.3rem;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 12px;
            transition: all 0.3s ease;
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.1);
        }

        .btn-primary {
            background: linear-gradient(135deg, #9370db 0%, #8a2be2 100%);
            color: white;
        }

        .btn-secondary {
            background: linear-gradient(135deg, #ffb6c1 0%, #ff69b4 100%);
            color: white;
        }

        .btn:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 20px rgba(0, 0, 0, 0.15);
        }

        .btn:active {
            transform: scale(0.98);
        }

        /* è¿›åº¦åŒºåŸŸ */
        .progress-area {
            width: 100%;
            background: white;
            border-radius: 25px;
            padding: 25px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.08);
            margin-bottom: 25px;
            border: 5px solid #e6e6fa;
        }

        .stats {
            display: flex;
            justify-content: space-around;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 20px;
        }

        .stat-box {
            text-align: center;
            padding: 15px;
            min-width: 150px;
            border-radius: 20px;
            background: #f9f9ff;
        }

        .stat-value {
            font-size: 2.2rem;
            font-weight: bold;
            color: #6a5acd;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 1.1rem;
            color: #696969;
        }

        .difficulty-info {
            text-align: center;
            font-size: 1.2rem;
            color: #483d8b;
            padding: 15px;
            background: #f0f8ff;
            border-radius: 15px;
            border: 3px dotted #9370db;
        }

        /* åé¦ˆæ¶ˆæ¯ */
        .feedback-message {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 30px 40px;
            border-radius: 25px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            text-align: center;
            display: none;
            border: 8px solid;
            max-width: 90%;
            animation: popIn 0.5s ease;
        }

        @keyframes popIn {
            0% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; }
            100% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
        }

        .feedback-icon {
            font-size: 4rem;
            margin-bottom: 15px;
        }

        .feedback-text {
            font-size: 1.8rem;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .feedback-subtext {
            font-size: 1.2rem;
            color: #666;
        }

        .close-feedback {
            margin-top: 20px;
            padding: 12px 25px;
            background: #9370db;
            color: white;
            border: none;
            border-radius: 50px;
            font-size: 1.1rem;
            cursor: pointer;
        }

        /* è§’è‰²åŠ¨ç”» */
        .character {
            position: absolute;
            bottom: 20px;
            right: 20px;
            width: 100px;
            height: 100px;
            z-index: 1;
        }

        .character img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        /* ç²’å­æ•ˆæœ */
        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            background-color: #f0f;
            top: -10px;
            z-index: 999;
        }

        /* å®¶é•¿æ§åˆ¶åŒºåŸŸ */
        .parent-controls {
            width: 100%;
            background: white;
            border-radius: 25px;
            padding: 20px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.08);
            margin-top: 20px;
            border: 5px solid #e6e6fa;
        }

        .parent-controls h3 {
            color: #483d8b;
            margin-bottom: 15px;
            text-align: center;
        }

        .settings {
            display: flex;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
        }

        .setting-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .setting-item label {
            font-size: 1.1rem;
            color: #696969;
        }

        /* å“åº”å¼è°ƒæ•´ */
        @media (max-width: 768px) {
            .game-container {
                padding: 20px;
            }
            
            .instruction {
                font-size: 1.4rem;
            }
            
            .word-display {
                font-size: 2rem;
            }
            
            .btn {
                padding: 15px 25px;
                font-size: 1.1rem;
            }
            
            .stat-box {
                min-width: 120px;
            }
        }

        /* æ‰“å°æ ·å¼ */
        @media print {
            .game-container, .progress-area, .parent-controls {
                box-shadow: none;
                border: 2px solid #ccc;
            }
            
            .btn, .character, .sound-wave {
                display: none !important;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logo">
                <i class="fas fa-music"></i> å¥‡å¦™å¬éŸ³ç›’
            </div>
            <div class="subtitle">å¬ä¸€å¬ï¼Œæ‰¾ä¸€æ‰¾ï¼ç”¨è€³æœµå‘ç°å¥‡å¦™ä¸–ç•Œ</div>
        </div>

        <div class="game-container">
            <!-- å¬åŠ›åŒºåŸŸ -->
            <div class="listening-area">
                <div class="sound-wave" id="soundWave">
                    <!-- å£°æ³¢åŠ¨ç”»æ¡å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
                </div>
                <div class="instruction" id="instruction">ä»”ç»†å¬ï¼Œç„¶åæ‰¾å‡ºå¯¹åº”çš„å›¾ç‰‡ï¼</div>
                <div class="word-display" id="wordDisplay">???</div>
                <button class="btn btn-primary" id="playSoundBtn">
                    <i class="fas fa-volume-up"></i> æ’­æ”¾å£°éŸ³
                </button>
            </div>

            <!-- é€‰é¡¹åŒºåŸŸ -->
            <div class="options-area" id="optionsArea">
                <!-- é€‰é¡¹å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
            </div>

            <!-- æ§åˆ¶æŒ‰é’® -->
            <div class="controls">
                <button class="btn btn-primary" id="hintBtn">
                    <i class="fas fa-lightbulb"></i> æˆ‘éœ€è¦æç¤º
                </button>
                <button class="btn btn-secondary" id="nextBtn">
                    <i class="fas fa-forward"></i> ä¸‹ä¸€ä¸ªå•è¯
                </button>
            </div>
        </div>

        <!-- è¿›åº¦åŒºåŸŸ -->
        <div class="progress-area">
            <div class="stats">
                <div class="stat-box">
                    <div class="stat-value" id="score">0</div>
                    <div class="stat-label">å¾—åˆ†</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value" id="streak">0</div>
                    <div class="stat-label">è¿ç»­æ­£ç¡®</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value" id="level">1</div>
                    <div class="stat-label">ç­‰çº§</div>
                </div>
            </div>
            <div class="difficulty-info" id="difficultyInfo">
                å½“å‰éš¾åº¦ï¼šç®€å• â€¢ é€‰é¡¹ï¼š3ä¸ª â€¢ å‘éŸ³é€Ÿåº¦ï¼šæ…¢é€Ÿ
            </div>
        </div>

        <!-- å®¶é•¿æ§åˆ¶åŒºåŸŸï¼ˆé»˜è®¤æŠ˜å ï¼‰ -->
        <div class="parent-controls">
            <h3><i class="fas fa-cog"></i> å®¶é•¿è®¾ç½®</h3>
            <div class="settings">
                <div class="setting-item">
                    <input type="checkbox" id="autoPlay" checked>
                    <label for="autoPlay">è‡ªåŠ¨æ’­æ”¾å£°éŸ³</label>
                </div>
                <div class="setting-item">
                    <input type="checkbox" id="soundEffects" checked>
                    <label for="soundEffects">å¼€å¯éŸ³æ•ˆ</label>
                </div>
                <div class="setting-item">
                    <label for="difficulty">éš¾åº¦çº§åˆ«ï¼š</label>
                    <select id="difficulty">
                        <option value="easy">ç®€å• (3ä¸ªé€‰é¡¹)</option>
                        <option value="medium" selected>ä¸­ç­‰ (4ä¸ªé€‰é¡¹)</option>
                        <option value="hard">å›°éš¾ (5ä¸ªé€‰é¡¹)</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- è§’è‰²åŠ¨ç”» -->
        <div class="character">
            <img src="https://cdn.jsdelivr.net/gh/twitter/twemoji@14.0.2/assets/svg/1f9a9.svg" alt="å‹å¥½çš„å°æ€ªå…½" id="characterImg">
        </div>
    </div>

    <!-- åé¦ˆæ¶ˆæ¯å¼¹çª— -->
    <div class="feedback-message" id="feedbackCorrect">
        <div class="feedback-icon" style="color: #32cd32;">
            <i class="fas fa-trophy"></i>
        </div>
        <div class="feedback-text">å¤ªæ£’äº†ï¼</div>
        <div class="feedback-subtext" id="correctMessage">ä½ çš„è€³æœµçœŸçµï¼</div>
        <button class="close-feedback">ç»§ç»­æ¸¸æˆ</button>
    </div>

    <div class="feedback-message" id="feedbackIncorrect">
        <div class="feedback-icon" style="color: #ff6b6b;">
            <i class="fas fa-redo"></i>
        </div>
        <div class="feedback-text">å†è¯•ä¸€æ¬¡ï¼</div>
        <div class="feedback-subtext" id="incorrectMessage">ä»”ç»†å¬ï¼Œä½ èƒ½åšåˆ°çš„ï¼</div>
        <button class="close-feedback" id="retryButton">å†è¯•ä¸€æ¬¡</button>
    </div>

    <!-- éŸ³é¢‘å…ƒç´  -->
    <audio id="correctSound" src="https://assets.mixkit.co/sfx/preview/mixkit-correct-answer-tone-2870.mp3"></audio>
    <audio id="incorrectSound" src="https://assets.mixkit.co/sfx/preview/mixkit-wrong-answer-fail-notification-946.mp3"></audio>
    <audio id="winSound" src="https://assets.mixkit.co/sfx/preview/mixkit-winning-chimes-2015.mp3"></audio>

    <script>
        // å•è¯æ•°æ®åº“ - é’ˆå¯¹3-6å²å„¿ç«¥çš„å¯è’™è¯æ±‡
        const wordDatabase = [
            // åŠ¨ç‰©ç±»
            { word: "cat", category: "animals", image: "ğŸ±", sound: "https://assets.mixkit.co/sfx/preview/mixkit-cat-meow-1090.mp3" },
            { word: "dog", category: "animals", image: "ğŸ¶", sound: "https://assets.mixkit.co/sfx/preview/mixkit-dog-barking-1105.mp3" },
            { word: "bird", category: "animals", image: "ğŸ¦", sound: "https://assets.mixkit.co/sfx/preview/mixkit-bird-chirping-1242.mp3" },
            { word: "cow", category: "animals", image: "ğŸ®", sound: "https://assets.mixkit.co/sfx/preview/mixkit-cow-moo-1101.mp3" },
            
            // é£Ÿç‰©ç±»
            { word: "apple", category: "food", image: "ğŸ", sound: "https://assets.mixkit.co/sfx/preview/mixkit-biting-into-an-apple-1993.mp3" },
            { word: "banana", category: "food", image: "ğŸŒ" },
            { word: "cake", category: "food", image: "ğŸ°" },
            { word: "milk", category: "food", image: "ğŸ¥›" },
            
            // äº¤é€šå·¥å…·
            { word: "car", category: "vehicles", image: "ğŸš—", sound: "https://assets.mixkit.co/sfx/preview/mixkit-car-engine-starting-1655.mp3" },
            { word: "bus", category: "vehicles", image: "ğŸšŒ" },
            { word: "train", category: "vehicles", image: "ğŸš‚", sound: "https://assets.mixkit.co/sfx/preview/mixkit-train-whistle-1254.mp3" },
            { word: "boat", category: "vehicles", image: "ğŸš¤" },
            
            // æ—¥å¸¸ç‰©å“
            { word: "ball", category: "objects", image: "âš½" },
            { word: "book", category: "objects", image: "ğŸ“š" },
            { word: "house", category: "objects", image: "ğŸ " },
            { word: "star", category: "objects", image: "â­" },
        ];

        // å¹²æ‰°é¡¹æ•°æ®åº“ - æŒ‰ç±»åˆ«åˆ†ç»„
        const distractors = {
            animals: ["ğŸ±", "ğŸ¶", "ğŸ¦", "ğŸ®", "ğŸ·", "ğŸ¸", "ğŸ°", "ğŸ»"],
            food: ["ğŸ", "ğŸŒ", "ğŸ°", "ğŸ¥›", "ğŸª", "ğŸ•", "ğŸ¦", "ğŸ‡"],
            vehicles: ["ğŸš—", "ğŸšŒ", "ğŸš‚", "ğŸš¤", "âœˆï¸", "ğŸš²", "ğŸ›µ", "ğŸš"],
            objects: ["âš½", "ğŸ“š", "ğŸ ", "â­", "ğŸ“±", "ğŸ›ï¸", "ğŸª‘", "ğŸ’¡"]
        };

        // æ¸¸æˆçŠ¶æ€
        let gameState = {
            score: 0,
            streak: 0,
            level: 1,
            currentWord: null,
            correctOptionIndex: 0,
            options: [],
            isPlaying: false,
            difficulty: "medium",
            totalCorrect: 0,
            totalAttempts: 0,
            wordHistory: [],
            // æ–°å¢ï¼šè®°å½•å½“å‰å¤±è´¥çš„å•è¯ï¼Œç”¨äº"å†è¯•ä¸€æ¬¡"åŠŸèƒ½
            failedWord: null,
            failedOptions: [],
            failedCorrectIndex: 0
        };

        // è¯­éŸ³çŠ¶æ€ç®¡ç†
        let speechQueue = [];
        let isSpeaking = false;
        let currentUtterance = null;

        // é¼“åŠ±æ¶ˆæ¯æ•°ç»„
        const correctMessages = [
            "å¤ªæ£’äº†ï¼ä½ çš„è€³æœµçœŸçµï¼",
            "å“‡ï¼ä½ å¬å¾—çœŸä»”ç»†ï¼",
            "å®Œå…¨æ­£ç¡®ï¼ä½ çœŸæ˜¯ä¸ªå¬åŠ›å°ä¸“å®¶ï¼",
            "åšå¾—å¥½ï¼ä½ æ‰¾åˆ°äº†ï¼",
            "å‰å®³ï¼ä¸€æ¬¡å°±çŒœå¯¹äº†ï¼",
            "ä½ çš„å¬åŠ›çœŸå‰å®³ï¼",
            "å¥½èªæ˜ï¼å®Œå…¨æ­£ç¡®ï¼",
            "ç­”å¯¹äº†ï¼ç»§ç»­åŠ æ²¹ï¼"
        ];

        const incorrectMessages = [
            "å†ä»”ç»†å¬ä¸€æ¬¡ï¼Œä½ èƒ½åšåˆ°çš„ï¼",
            "åˆ«ç°å¿ƒï¼Œå†è¯•ä¸€æ¬¡ï¼",
            "ä»”ç»†å¬å¬ï¼Œå£°éŸ³æ˜¯ä»å“ªé‡Œæ¥çš„ï¼Ÿ",
            "å·®ä¸€ç‚¹ç‚¹ï¼Œå†è¯•ä¸€æ¬¡å§ï¼",
            "æ²¡å…³ç³»ï¼Œæˆ‘ä»¬å†æ¥ä¸€æ¬¡ï¼",
            "è®©æˆ‘ä»¬å†å¬ä¸€éå£°éŸ³ï¼",
            "æ¥è¿‘äº†ï¼Œå†è¯•ä¸€æ¬¡ï¼",
            "åŠ æ²¹ï¼Œä½ èƒ½æ‰¾åˆ°çš„ï¼"
        ];

        // DOMå…ƒç´ 
        const wordDisplay = document.getElementById('wordDisplay');
        const optionsArea = document.getElementById('optionsArea');
        const playSoundBtn = document.getElementById('playSoundBtn');
        const hintBtn = document.getElementById('hintBtn');
        const nextBtn = document.getElementById('nextBtn');
        const scoreElement = document.getElementById('score');
        const streakElement = document.getElementById('streak');
        const levelElement = document.getElementById('level');
        const difficultyInfo = document.getElementById('difficultyInfo');
        const soundWave = document.getElementById('soundWave');
        const instruction = document.getElementById('instruction');
        const feedbackCorrect = document.getElementById('feedbackCorrect');
        const feedbackIncorrect = document.getElementById('feedbackIncorrect');
        const correctMessage = document.getElementById('correctMessage');
        const incorrectMessage = document.getElementById('incorrectMessage');
        const characterImg = document.getElementById('characterImg');
        const difficultySelect = document.getElementById('difficulty');
        const autoPlayCheckbox = document.getElementById('autoPlay');
        const soundEffectsCheckbox = document.getElementById('soundEffects');
        const retryButton = document.getElementById('retryButton');

        // éŸ³é¢‘å…ƒç´ 
        const correctSound = document.getElementById('correctSound');
        const incorrectSound = document.getElementById('incorrectSound');
        const winSound = document.getElementById('winSound');

        // åˆå§‹åŒ–æ¸¸æˆ
        function initGame() {
            createSoundWave();
            updateStats();
            generateNewWord();
            setupEventListeners();
            
            // å¦‚æœè‡ªåŠ¨æ’­æ”¾å¼€å¯ï¼Œæ’­æ”¾å£°éŸ³
            if (autoPlayCheckbox.checked) {
                setTimeout(() => {
                    playWordSound();
                }, 1000);
            }
        }

        // åˆ›å»ºå£°æ³¢åŠ¨ç”»
        function createSoundWave() {
            soundWave.innerHTML = '';
            for (let i = 0; i < 9; i++) {
                const bar = document.createElement('div');
                bar.className = 'wave-bar';
                bar.style.setProperty('--i', i);
                soundWave.appendChild(bar);
            }
        }

        // ç”Ÿæˆæ–°å•è¯
        function generateNewWord() {
            // é€‰æ‹©æ–°å•è¯ï¼ˆé¿å…è¿ç»­é‡å¤ï¼‰
            let availableWords = wordDatabase.filter(word => 
                !gameState.wordHistory.slice(-3).includes(word.word)
            );
            
            if (availableWords.length === 0) {
                availableWords = wordDatabase;
            }
            
            const randomIndex = Math.floor(Math.random() * availableWords.length);
            gameState.currentWord = availableWords[randomIndex];
            gameState.wordHistory.push(gameState.currentWord.word);
            
            // æ ¹æ®éš¾åº¦ç¡®å®šé€‰é¡¹æ•°é‡
            let optionCount = 3;
            switch(gameState.difficulty) {
                case 'easy': optionCount = 3; break;
                case 'medium': optionCount = 4; break;
                case 'hard': optionCount = 5; break;
            }
            
            // ç”Ÿæˆé€‰é¡¹ï¼ˆåŒ…å«æ­£ç¡®ç­”æ¡ˆå’Œå¹²æ‰°é¡¹ï¼‰
            gameState.options = [gameState.currentWord.image];
            gameState.correctOptionIndex = 0;
            
            // è·å–ç›¸åŒç±»åˆ«çš„å¹²æ‰°é¡¹
            const categoryDistractors = distractors[gameState.currentWord.category] || distractors.animals;
            const availableDistractors = categoryDistractors.filter(img => img !== gameState.currentWord.image);
            
            // éšæœºé€‰æ‹©å¹²æ‰°é¡¹
            while (gameState.options.length < optionCount && availableDistractors.length > 0) {
                const randomDistractorIndex = Math.floor(Math.random() * availableDistractors.length);
                const distractor = availableDistractors.splice(randomDistractorIndex, 1)[0];
                gameState.options.push(distractor);
            }
            
            // éšæœºæ’åºé€‰é¡¹
            shuffleArray(gameState.options);
            
            // æ›´æ–°æ­£ç¡®é€‰é¡¹çš„ç´¢å¼•
            gameState.correctOptionIndex = gameState.options.indexOf(gameState.currentWord.image);
            
            // æ›´æ–°æ˜¾ç¤º
            updateDisplay();
            
            // æ›´æ–°æŒ‡ä»¤æ–‡æœ¬
            instruction.textContent = `å¬å£°éŸ³ï¼Œæ‰¾å‡º${getCategoryName(gameState.currentWord.category)}ï¼`;
            
            // æ›´æ–°éš¾åº¦ä¿¡æ¯
            updateDifficultyInfo();
        }

        // æ›´æ–°æ˜¾ç¤º
        function updateDisplay() {
            // æ˜¾ç¤ºå•è¯ï¼ˆå…ˆéšè—ï¼Œç­”å¯¹åæ˜¾ç¤ºï¼‰
            wordDisplay.textContent = "???";
            wordDisplay.style.color = "#4b0082";
            
            // æ¸…é™¤é€‰é¡¹åŒºåŸŸ
            optionsArea.innerHTML = '';
            
            // ç”Ÿæˆé€‰é¡¹æŒ‰é’®
            gameState.options.forEach((option, index) => {
                const optionElement = document.createElement('div');
                optionElement.className = 'option';
                optionElement.dataset.index = index;
                
                // è¡¨æƒ…ç¬¦å·å›¾ç‰‡
                const img = document.createElement('div');
                img.className = 'option-img';
                img.style.fontSize = '80px';
                img.style.display = 'flex';
                img.style.alignItems = 'center';
                img.style.justifyContent = 'center';
                img.textContent = option;
                
                // æ ‡ç­¾ï¼ˆå¼€å§‹æ—¶éšè—ï¼‰
                const label = document.createElement('div');
                label.className = 'option-label';
                label.textContent = getWordFromEmoji(option) || "???";
                label.style.opacity = "0";
                
                optionElement.appendChild(img);
                optionElement.appendChild(label);
                
                // ç‚¹å‡»äº‹ä»¶
                optionElement.addEventListener('click', () => selectOption(index));
                
                optionsArea.appendChild(optionElement);
            });
            
            // é‡ç½®æ¸¸æˆçŠ¶æ€
            gameState.isPlaying = true;
            
            // æ›´æ–°è§’è‰²è¡¨æƒ…
            characterImg.src = "https://cdn.jsdelivr.net/gh/twitter/twemoji@14.0.2/assets/svg/1f9a9.svg";
        }

        // é€‰æ‹©é€‰é¡¹
        function selectOption(selectedIndex) {
            if (!gameState.isPlaying) return;
            
            gameState.isPlaying = false;
            gameState.totalAttempts++;
            
            const isCorrect = selectedIndex === gameState.correctOptionIndex;
            const optionElements = document.querySelectorAll('.option');
            
            // æ˜¾ç¤ºæ‰€æœ‰é€‰é¡¹çš„æ ‡ç­¾
            document.querySelectorAll('.option-label').forEach(label => {
                label.style.opacity = "1";
            });
            
            // æ˜¾ç¤ºå•è¯
            wordDisplay.textContent = gameState.currentWord.word;
            
            if (isCorrect) {
                // æ­£ç¡®åé¦ˆ
                gameState.score += 10;
                gameState.streak++;
                gameState.totalCorrect++;
                
                // å¦‚æœè¿ç»­æ­£ç¡®5æ¬¡ï¼Œå‡çº§
                if (gameState.streak % 5 === 0 && gameState.level < 5) {
                    gameState.level++;
                    showLevelUpMessage();
                }
                
                // æ­£ç¡®é€‰é¡¹æ•ˆæœ
                optionElements[selectedIndex].classList.add('correct');
                
                // æ’­æ”¾æ­£ç¡®éŸ³æ•ˆ
                if (soundEffectsCheckbox.checked) {
                    correctSound.currentTime = 0;
                    correctSound.play();
                }
                
                // æ˜¾ç¤ºæ­£ç¡®åé¦ˆæ¶ˆæ¯
                correctMessage.textContent = correctMessages[Math.floor(Math.random() * correctMessages.length)];
                feedbackCorrect.style.display = 'block';
                
                // è§’è‰²é«˜å…´è¡¨æƒ…
                characterImg.src = "https://cdn.jsdelivr.net/gh/twitter/twemoji@14.0.2/assets/svg/1f60a.svg";
                
                // åˆ›å»ºåº†ç¥ç²’å­
                createConfetti();
                
                // æ¸…é™¤å¤±è´¥è®°å½•
                gameState.failedWord = null;
                gameState.failedOptions = [];
                gameState.failedCorrectIndex = 0;
            } else {
                // é”™è¯¯åé¦ˆ
                gameState.streak = 0;
                
                // ä¿å­˜å¤±è´¥çš„å•è¯ä¿¡æ¯ï¼Œç”¨äº"å†è¯•ä¸€æ¬¡"åŠŸèƒ½
                gameState.failedWord = gameState.currentWord;
                gameState.failedOptions = [...gameState.options];
                gameState.failedCorrectIndex = gameState.correctOptionIndex;
                
                // é”™è¯¯é€‰é¡¹æ•ˆæœ
                optionElements[selectedIndex].classList.add('incorrect');
                
                // æ­£ç¡®é€‰é¡¹æç¤º
                optionElements[gameState.correctOptionIndex].classList.add('hint');
                
                // æ’­æ”¾é”™è¯¯éŸ³æ•ˆ
                if (soundEffectsCheckbox.checked) {
                    incorrectSound.currentTime = 0;
                    incorrectSound.play();
                }
                
                // æ˜¾ç¤ºé”™è¯¯åé¦ˆæ¶ˆæ¯
                incorrectMessage.textContent = incorrectMessages[Math.floor(Math.random() * incorrectMessages.length)];
                feedbackIncorrect.style.display = 'block';
                
                // è§’è‰²é¼“åŠ±è¡¨æƒ…
                characterImg.src = "https://cdn.jsdelivr.net/gh/twitter/twemoji@14.0.2/assets/svg/1f972.svg";
            }
            
            updateStats();
        }

        // æ’­æ”¾å•è¯å£°éŸ³ - ä¿®å¤ç‰ˆ
        function playWordSound() {
            if (!gameState.currentWord) return;
            
            // æ¸…é™¤å½“å‰è¯­éŸ³
            if (currentUtterance) {
                speechSynthesis.cancel();
                isSpeaking = false;
                currentUtterance = null;
            }
            
            // å¦‚æœæœ‰è‡ªå®šä¹‰å£°éŸ³ï¼Œä½¿ç”¨å®ƒ
            if (gameState.currentWord.sound) {
                const audio = new Audio(gameState.currentWord.sound);
                audio.play().catch(e => {
                    console.log("éŸ³é¢‘æ’­æ”¾å¤±è´¥ï¼Œä½¿ç”¨è¯­éŸ³åˆæˆ:", e);
                    // å¦‚æœéŸ³é¢‘æ’­æ”¾å¤±è´¥ï¼Œä½¿ç”¨è¯­éŸ³åˆæˆ
                    speakWord(gameState.currentWord.word);
                });
            } else {
                // ä½¿ç”¨è¯­éŸ³åˆæˆ
                speakWord(gameState.currentWord.word);
            }
            
            // æ¿€æ´»å£°æ³¢åŠ¨ç”»
            animateSoundWave();
        }

        // è¯­éŸ³åˆæˆè¾…åŠ©å‡½æ•°
        function speakWord(text) {
            // ç¡®ä¿æ²¡æœ‰æ­£åœ¨è¿›è¡Œçš„è¯­éŸ³
            speechSynthesis.cancel();
            
            // åˆ›å»ºæ–°çš„è¯­éŸ³å®ä¾‹
            currentUtterance = new SpeechSynthesisUtterance(text);
            currentUtterance.lang = 'en-US';
            currentUtterance.rate = 0.8; // æ…¢é€Ÿ
            currentUtterance.pitch = 1.2; // è¾ƒé«˜çš„éŸ³è°ƒï¼Œå¯¹å­©å­æ›´å‹å¥½
            
            // è¯­éŸ³å¼€å§‹äº‹ä»¶
            currentUtterance.onstart = () => {
                isSpeaking = true;
                animateSoundWave();
            };
            
            // è¯­éŸ³ç»“æŸäº‹ä»¶
            currentUtterance.onend = () => {
                isSpeaking = false;
                currentUtterance = null;
                resetSoundWave();
                
                // å¤„ç†é˜Ÿåˆ—ä¸­çš„ä¸‹ä¸€ä¸ªè¯­éŸ³
                if (speechQueue.length > 0) {
                    const nextText = speechQueue.shift();
                    setTimeout(() => speakWord(nextText), 300);
                }
            };
            
            // è¯­éŸ³é”™è¯¯äº‹ä»¶
            currentUtterance.onerror = (event) => {
                console.log("è¯­éŸ³åˆæˆé”™è¯¯:", event);
                isSpeaking = false;
                currentUtterance = null;
                resetSoundWave();
                
                // å°è¯•ä½¿ç”¨å¤‡ç”¨æ–¹æ³•
                if (speechQueue.length === 0) {
                    // å¦‚æœæ²¡æœ‰åœ¨é˜Ÿåˆ—ä¸­ï¼Œç›´æ¥é‡è¯•
                    setTimeout(() => speakWord(text), 500);
                }
            };
            
            // ç­‰å¾…ä¸€å°æ®µæ—¶é—´ç¡®ä¿ä¹‹å‰çš„è¯­éŸ³å®Œå…¨åœæ­¢
            setTimeout(() => {
                speechSynthesis.speak(currentUtterance);
            }, 100);
        }

        // å£°æ³¢åŠ¨ç”»
        function animateSoundWave() {
            const waveBars = document.querySelectorAll('.wave-bar');
            waveBars.forEach(bar => {
                bar.style.animation = 'none';
                setTimeout(() => {
                    bar.style.animation = 'wave 1.2s ease-in-out infinite';
                }, 10);
            });
        }

        // é‡ç½®å£°æ³¢åŠ¨ç”»
        function resetSoundWave() {
            const waveBars = document.querySelectorAll('.wave-bar');
            waveBars.forEach(bar => {
                bar.style.animation = 'wave 1.2s ease-in-out infinite';
            });
        }

        // æç¤ºåŠŸèƒ½
        function showHint() {
            if (!gameState.isPlaying) return;
            
            const optionElements = document.querySelectorAll('.option');
            optionElements[gameState.correctOptionIndex].classList.add('hint');
            
            // è§’è‰²æç¤ºè¡¨æƒ…
            characterImg.src = "https://cdn.jsdelivr.net/gh/twitter/twemoji@14.0.2/assets/svg/1f914.svg";
            
            // æ’­æ”¾å£°éŸ³æç¤º
            playWordSound();
        }

        // é‡æ–°å¼€å§‹å½“å‰å¤±è´¥çš„å•è¯
        function retryCurrentWord() {
            if (!gameState.failedWord) {
                // å¦‚æœæ²¡æœ‰å¤±è´¥è®°å½•ï¼Œç”Ÿæˆæ–°å•è¯
                generateNewWord();
                return;
            }
            
            // ä½¿ç”¨ä¹‹å‰å¤±è´¥çš„å•è¯å’Œé€‰é¡¹
            gameState.currentWord = gameState.failedWord;
            gameState.options = [...gameState.failedOptions];
            gameState.correctOptionIndex = gameState.failedCorrectIndex;
            
            // æ›´æ–°æ˜¾ç¤º
            wordDisplay.textContent = "???";
            wordDisplay.style.color = "#4b0082";
            
            // æ¸…é™¤é€‰é¡¹åŒºåŸŸ
            optionsArea.innerHTML = '';
            
            // é‡æ–°ç”Ÿæˆé€‰é¡¹æŒ‰é’®
            gameState.options.forEach((option, index) => {
                const optionElement = document.createElement('div');
                optionElement.className = 'option';
                optionElement.dataset.index = index;
                
                // è¡¨æƒ…ç¬¦å·å›¾ç‰‡
                const img = document.createElement('div');
                img.className = 'option-img';
                img.style.fontSize = '80px';
                img.style.display = 'flex';
                img.style.alignItems = 'center';
                img.style.justifyContent = 'center';
                img.textContent = option;
                
                // æ ‡ç­¾ï¼ˆå¼€å§‹æ—¶éšè—ï¼‰
                const label = document.createElement('div');
                label.className = 'option-label';
                label.textContent = getWordFromEmoji(option) || "???";
                label.style.opacity = "0";
                
                optionElement.appendChild(img);
                optionElement.appendChild(label);
                
                // ç‚¹å‡»äº‹ä»¶
                optionElement.addEventListener('click', () => selectOption(index));
                
                optionsArea.appendChild(optionElement);
            });
            
            // é‡ç½®æ¸¸æˆçŠ¶æ€
            gameState.isPlaying = true;
            
            // æ›´æ–°æŒ‡ä»¤æ–‡æœ¬
            instruction.textContent = `å†è¯•ä¸€æ¬¡ï¼æ‰¾å‡º${getCategoryName(gameState.currentWord.category)}ï¼`;
            
            // æ›´æ–°è§’è‰²è¡¨æƒ…
            characterImg.src = "https://cdn.jsdelivr.net/gh/twitter/twemoji@14.0.2/assets/svg/1f9a9.svg";
            
            // æ’­æ”¾å£°éŸ³
            if (autoPlayCheckbox.checked) {
                setTimeout(() => {
                    playWordSound();
                }, 300);
            }
        }

        // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
        function updateStats() {
            scoreElement.textContent = gameState.score;
            streakElement.textContent = gameState.streak;
            levelElement.textContent = gameState.level;
        }

        // æ›´æ–°éš¾åº¦ä¿¡æ¯
        function updateDifficultyInfo() {
            let optionCount, speed;
            
            switch(gameState.difficulty) {
                case 'easy':
                    optionCount = 3;
                    speed = "æ…¢é€Ÿ";
                    break;
                case 'medium':
                    optionCount = 4;
                    speed = "ä¸­é€Ÿ";
                    break;
                case 'hard':
                    optionCount = 5;
                    speed = "å¿«é€Ÿ";
                    break;
            }
            
            const accuracy = gameState.totalAttempts > 0 
                ? Math.round((gameState.totalCorrect / gameState.totalAttempts) * 100) 
                : 0;
                
            difficultyInfo.innerHTML = `
                å½“å‰éš¾åº¦ï¼š${getDifficultyName(gameState.difficulty)} â€¢ 
                é€‰é¡¹ï¼š${optionCount}ä¸ª â€¢ 
                å‘éŸ³é€Ÿåº¦ï¼š${speed} â€¢ 
                æ­£ç¡®ç‡ï¼š${accuracy}%
            `;
        }

        // æ˜¾ç¤ºå‡çº§æ¶ˆæ¯
        function showLevelUpMessage() {
            if (soundEffectsCheckbox.checked) {
                winSound.currentTime = 0;
                winSound.play();
            }
            
            // åˆ›å»ºå¤§é‡åº†ç¥ç²’å­
            for (let i = 0; i < 50; i++) {
                createConfetti();
            }
            
            // è§’è‰²åº†ç¥è¡¨æƒ…
            characterImg.src = "https://cdn.jsdelivr.net/gh/twitter/twemoji@14.0.2/assets/svg/1f389.svg";
            
            // çŸ­æš‚æ˜¾ç¤ºå‡çº§æ¶ˆæ¯
            const originalInstruction = instruction.textContent;
            instruction.textContent = `æ­å–œï¼ä½ å‡åˆ° ${gameState.level} çº§äº†ï¼`;
            instruction.style.color = "#ff4500";
            
            setTimeout(() => {
                instruction.textContent = originalInstruction;
                instruction.style.color = "#483d8b";
            }, 2000);
        }

        // åˆ›å»ºåº†ç¥ç²’å­
        function createConfetti() {
            const confetti = document.createElement('div');
            confetti.className = 'confetti';
            
            // éšæœºé¢œè‰²
            const colors = ['#ff6b6b', '#4ecdc4', '#45b7d1', '#96ceb4', '#feca57', '#ff9ff3', '#54a0ff'];
            confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
            
            // éšæœºä½ç½®
            confetti.style.left = Math.random() * 100 + 'vw';
            
            // éšæœºå¤§å°
            const size = Math.random() * 10 + 5;
            confetti.style.width = size + 'px';
            confetti.style.height = size + 'px';
            
            // éšæœºå½¢çŠ¶
            confetti.style.borderRadius = Math.random() > 0.5 ? '50%' : '0';
            
            document.body.appendChild(confetti);
            
            // åŠ¨ç”»
            const animation = confetti.animate([
                { top: '-10px', transform: 'rotate(0deg)' },
                { top: '100vh', transform: 'rotate(360deg)' }
            ], {
                duration: Math.random() * 3000 + 2000,
                easing: 'cubic-bezier(0.215, 0.61, 0.355, 1)'
            });
            
            // åŠ¨ç”»ç»“æŸåç§»é™¤å…ƒç´ 
            animation.onfinish = () => {
                confetti.remove();
            };
        }

        // å·¥å…·å‡½æ•°
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        function getCategoryName(category) {
            const categoryNames = {
                animals: "å°åŠ¨ç‰©",
                food: "é£Ÿç‰©",
                vehicles: "äº¤é€šå·¥å…·",
                objects: "ç‰©å“"
            };
            return categoryNames[category] || "ç‰©å“";
        }

        function getDifficultyName(difficulty) {
            const difficultyNames = {
                easy: "ç®€å•",
                medium: "ä¸­ç­‰",
                hard: "å›°éš¾"
            };
            return difficultyNames[difficulty] || "ä¸­ç­‰";
        }

        function getWordFromEmoji(emoji) {
            const emojiMap = {
                "ğŸ±": "cat",
                "ğŸ¶": "dog",
                "ğŸ¦": "bird",
                "ğŸ®": "cow",
                "ğŸ": "apple",
                "ğŸŒ": "banana",
                "ğŸ°": "cake",
                "ğŸ¥›": "milk",
                "ğŸš—": "car",
                "ğŸšŒ": "bus",
                "ğŸš‚": "train",
                "ğŸš¤": "boat",
                "âš½": "ball",
                "ğŸ“š": "book",
                "ğŸ ": "house",
                "â­": "star"
            };
            return emojiMap[emoji] || null;
        }

        // è®¾ç½®äº‹ä»¶ç›‘å¬å™¨
        function setupEventListeners() {
            // æ’­æ”¾å£°éŸ³æŒ‰é’®
            playSoundBtn.addEventListener('click', playWordSound);
            
            // æç¤ºæŒ‰é’®
            hintBtn.addEventListener('click', showHint);
            
            // ä¸‹ä¸€ä¸ªæŒ‰é’®
            nextBtn.addEventListener('click', () => {
                // åœæ­¢å½“å‰è¯­éŸ³
                if (currentUtterance) {
                    speechSynthesis.cancel();
                    isSpeaking = false;
                    currentUtterance = null;
                }
                
                generateNewWord();
                
                // å¦‚æœè‡ªåŠ¨æ’­æ”¾å¼€å¯ï¼Œæ’­æ”¾å£°éŸ³
                if (autoPlayCheckbox.checked) {
                    setTimeout(() => {
                        playWordSound();
                    }, 500);
                }
            });
            
            // å…³é—­æ­£ç¡®åé¦ˆæ¶ˆæ¯
            document.querySelectorAll('.close-feedback').forEach(button => {
                if (button.id !== 'retryButton') {
                    button.addEventListener('click', () => {
                        feedbackCorrect.style.display = 'none';
                        
                        // ç”Ÿæˆæ–°å•è¯
                        setTimeout(() => {
                            // åœæ­¢å½“å‰è¯­éŸ³
                            if (currentUtterance) {
                                speechSynthesis.cancel();
                                isSpeaking = false;
                                currentUtterance = null;
                            }
                            
                            generateNewWord();
                            
                            // å¦‚æœè‡ªåŠ¨æ’­æ”¾å¼€å¯ï¼Œæ’­æ”¾å£°éŸ³
                            if (autoPlayCheckbox.checked) {
                                setTimeout(() => {
                                    playWordSound();
                                }, 500);
                            }
                        }, 300);
                    });
                }
            });
            
            // "å†è¯•ä¸€æ¬¡"æŒ‰é’®çš„ç‰¹æ®Šå¤„ç†
            retryButton.addEventListener('click', () => {
                feedbackIncorrect.style.display = 'none';
                
                // ä½¿ç”¨ç›¸åŒçš„å•è¯é‡æ–°å¼€å§‹
                setTimeout(() => {
                    // åœæ­¢å½“å‰è¯­éŸ³
                    if (currentUtterance) {
                        speechSynthesis.cancel();
                        isSpeaking = false;
                        currentUtterance = null;
                    }
                    
                    retryCurrentWord();
                }, 300);
            });
            
            // éš¾åº¦é€‰æ‹©
            difficultySelect.addEventListener('change', () => {
                // åœæ­¢å½“å‰è¯­éŸ³
                if (currentUtterance) {
                    speechSynthesis.cancel();
                    isSpeaking = false;
                    currentUtterance = null;
                }
                
                gameState.difficulty = difficultySelect.value;
                updateDifficultyInfo();
                generateNewWord();
            });
            
            // è‡ªåŠ¨æ’­æ”¾è®¾ç½®
            autoPlayCheckbox.addEventListener('change', () => {
                if (autoPlayCheckbox.checked && gameState.isPlaying) {
                    playWordSound();
                }
            });
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–æ¸¸æˆ
        document.addEventListener('DOMContentLoaded', initGame);
        
        // æ·»åŠ é”®ç›˜å¿«æ·é”®æ”¯æŒï¼ˆä¾›å®¶é•¿ä½¿ç”¨ï¼‰
        document.addEventListener('keydown', (event) => {
            // ç©ºæ ¼é”®æ’­æ”¾å£°éŸ³
            if (event.code === 'Space') {
                event.preventDefault();
                playWordSound();
            }
            
            // æ•°å­—é”®1-5é€‰æ‹©é€‰é¡¹
            if (event.code >= 'Digit1' && event.code <= 'Digit5' && gameState.isPlaying) {
                const optionIndex = parseInt(event.code.replace('Digit', '')) - 1;
                if (optionIndex < gameState.options.length) {
                    selectOption(optionIndex);
                }
            }
            
            // Né”®ä¸‹ä¸€ä¸ªå•è¯
            if (event.code === 'KeyN') {
                // åœæ­¢å½“å‰è¯­éŸ³
                if (currentUtterance) {
                    speechSynthesis.cancel();
                    isSpeaking = false;
                    currentUtterance = null;
                }
                
                generateNewWord();
                if (autoPlayCheckbox.checked) {
                    setTimeout(() => {
                        playWordSound();
                    }, 500);
                }
            }
            
            // Hé”®æç¤º
            if (event.code === 'KeyH') {
                showHint();
            }
            
            // Ré”®å†è¯•ä¸€æ¬¡
            if (event.code === 'KeyR' && gameState.failedWord) {
                feedbackIncorrect.style.display = 'none';
                setTimeout(() => {
                    retryCurrentWord();
                }, 300);
            }
        });
    </script>
</body>
</html>