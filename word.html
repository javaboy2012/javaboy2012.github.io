<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å•è¯æ•…äº‹å­¦ä¹ ç³»ç»Ÿ MVP</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            padding: 30px;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #eaeaea;
        }

        h1 {
            color: #2c3e50;
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .subtitle {
            color: #7f8c8d;
            font-size: 1.1em;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .word-count {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        #toggleMode {
            background: #3498db;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9em;
            transition: background 0.3s;
        }

        #toggleMode:hover {
            background: #2980b9;
        }

        .story-container {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 10px;
            line-height: 1.8;
            font-size: 1.1em;
            margin-bottom: 20px;
            border-left: 4px solid #3498db;
        }

        .word-chinese {
            color: #e74c3c;
            font-weight: bold;
            cursor: pointer;
            padding: 2px 4px;
            border-radius: 3px;
            transition: all 0.3s;
            position: relative;
        }

        .word-chinese:hover {
            background: #ffeaa7;
            transform: translateY(-2px);
        }

        .word-english {
            color: #3498db;
            font-weight: bold;
            cursor: pointer;
            padding: 2px 4px;
            border-radius: 3px;
            transition: all 0.3s;
            position: relative;
        }

        .word-english:hover {
            background: #d6eaf8;
            transform: translateY(-2px);
        }

        .instructions {
            background: #e8f4fc;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            font-size: 0.95em;
        }

        .highlight {
            color: #e74c3c;
            font-weight: bold;
        }

        .words-section {
            margin-top: 30px;
        }

        .words-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .word-card {
            background: white;
            border: 2px solid #eaeaea;
            border-radius: 8px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .word-card:hover {
            border-color: #3498db;
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.2);
        }

        .word-card h4 {
            color: #2c3e50;
            margin-bottom: 5px;
        }

        .word-card .phonetic {
            color: #7f8c8d;
            font-size: 0.9em;
            margin-bottom: 8px;
        }

        .word-card .meaning {
            font-size: 0.95em;
            color: #34495e;
        }

        .favorite-star {
            color: #f39c12;
            float: right;
            font-size: 1.2em;
        }

        /* æ¨¡æ€æ¡†æ ·å¼ */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background: white;
            width: 90%;
            max-width: 500px;
            border-radius: 15px;
            padding: 30px;
            position: relative;
            animation: modalSlideIn 0.3s ease;
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .close-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 24px;
            background: none;
            border: none;
            cursor: pointer;
            color: #7f8c8d;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }

        .close-btn:hover {
            background: #f8f9fa;
            color: #e74c3c;
        }

        .word-header {
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f8f9fa;
        }

        .word-header h3 {
            color: #2c3e50;
            font-size: 2em;
            margin-bottom: 5px;
        }

        .phonetic {
            color: #7f8c8d;
            font-style: italic;
        }

        .example {
            margin: 20px 0;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .english-example {
            color: #2c3e50;
            font-size: 1.1em;
            margin-bottom: 8px;
            font-style: italic;
        }

        .chinese-example {
            color: #7f8c8d;
        }

        .word-actions {
            display: flex;
            gap: 10px;
            margin-top: 25px;
            flex-wrap: wrap;
        }

        .speak-btn, .favorite-btn {
            flex: 1;
            min-width: 120px;
            padding: 12px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .speak-btn {
            background: #3498db;
            color: white;
        }

        .speak-btn:hover {
            background: #2980b9;
        }

        .favorite-btn {
            background: #f1c40f;
            color: white;
        }

        .favorite-btn:hover {
            background: #f39c12;
        }

        .favorite-btn.favorited {
            background: #e74c3c;
        }

        footer {
            text-align: center;
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid #eaeaea;
            color: #7f8c8d;
            font-size: 0.9em;
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .container {
                padding: 20px;
            }
            
            h1 {
                font-size: 2em;
            }
            
            .section-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
            
            .words-list {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            }
            
            .modal-content {
                width: 95%;
                padding: 20px;
            }
            
            .word-actions {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ“š å•è¯æ•…äº‹å­¦ä¹ ç³»ç»Ÿ MVP</h1>
            <p class="subtitle">é€šè¿‡æœ‰è¶£çš„æ•…äº‹å­¦ä¹ è‹±è¯­å•è¯ - å•æ–‡ä»¶æ¼”ç¤ºç‰ˆ</p>
        </header>

        <main>
            <section class="story-section">
                <div class="section-header">
                    <h2>ç¥ç§˜æ£®æ—çš„å†’é™©</h2>
                    <div class="word-count">
                        <span>åŒ…å«å•è¯: 10ä¸ª</span>
                        <button id="toggleMode">æ˜¾ç¤ºè‹±æ–‡æ¨¡å¼</button>
                    </div>
                </div>
                
                <div class="story-container" id="storyContainer">
                    <!-- æ•…äº‹å†…å®¹å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
                </div>
                
                <div class="instructions">
                    <p>ğŸ’¡ æç¤ºï¼šç‚¹å‡»<span class="highlight">ä¸­æ–‡å•è¯</span>æ˜¾ç¤ºè‹±æ–‡ï¼Œç‚¹å‡»<span class="highlight">è‹±æ–‡å•è¯</span>æŸ¥çœ‹è¯¦æƒ…</p>
                </div>
            </section>

            <section class="words-section">
                <h3>æœ¬æ•…äº‹åŒ…å«çš„å•è¯</h3>
                <div class="words-list" id="wordsList">
                    <!-- å•è¯åˆ—è¡¨å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
                </div>
            </section>
        </main>

        <footer>
            <p>å•è¯å­¦ä¹ ç³»ç»Ÿ MVP æ¼”ç¤ºç‰ˆ | ç‚¹å‡»å•è¯å¼€å§‹å­¦ä¹  | æ‰€æœ‰åŠŸèƒ½åœ¨ä¸€ä¸ªHTMLæ–‡ä»¶ä¸­</p>
        </footer>
    </div>

    <!-- å•è¯è¯¦æƒ…å¼¹çª— -->
    <div class="modal" id="wordModal">
        <div class="modal-content">
            <button class="close-btn" id="closeModal">Ã—</button>
            <div class="word-header">
                <h3 id="modalEnglish"></h3>
                <span class="phonetic" id="modalPhonetic"></span>
            </div>
            
            <div class="word-details">
                <p><strong>ä¸­æ–‡é‡Šä¹‰:</strong> <span id="modalChinese"></span></p>
                
                <div class="example">
                    <p><strong>ä¾‹å¥:</strong></p>
                    <p class="english-example" id="modalExampleEN"></p>
                    <p class="chinese-example" id="modalExampleCN"></p>
                </div>
                
                <div class="word-actions">
                    <button class="speak-btn" id="speakWord">
                        ğŸ”Š æœ—è¯»å•è¯
                    </button>
                    <button class="favorite-btn" id="toggleFavorite">
                        â­ æ”¶è—
                    </button>
                    <button class="speak-btn" id="speakExample">
                        ğŸ”Š æœ—è¯»ä¾‹å¥
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ================================
        // æ•°æ®å®šä¹‰éƒ¨åˆ†
        // ================================
        
        // å•è¯æ•°æ®
        const demoWords = [
            {
                id: 1,
                chinese: "è‹¹æœ",
                english: "apple",
                phonetic: "/ËˆÃ¦pl/",
                chineseMeaning: "è‹¹æœï¼›è‹¹æœå…¬å¸",
                exampleEN: "I eat an apple every day for breakfast.",
                exampleCN: "æˆ‘æ¯å¤©æ—©é¤éƒ½åƒä¸€ä¸ªè‹¹æœã€‚",
                isFavorite: false
            },
            {
                id: 2,
                chinese: "å†’é™©",
                english: "adventure",
                phonetic: "/É™dËˆventÊƒÉ™r/",
                chineseMeaning: "å†’é™©ï¼›å¥‡é‡",
                exampleEN: "Their jungle adventure was full of surprises.",
                exampleCN: "ä»–ä»¬çš„ä¸›æ—å†’é™©å……æ»¡äº†æƒŠå–œã€‚",
                isFavorite: false
            },
            {
                id: 3,
                chinese: "ç¾å‘³",
                english: "delicious",
                phonetic: "/dÉªËˆlÉªÊƒÉ™s/",
                chineseMeaning: "ç¾å‘³çš„ï¼Œå¯å£çš„",
                exampleEN: "The cake was absolutely delicious.",
                exampleCN: "è¿™ä¸ªè›‹ç³•ç»å¯¹ç¾å‘³ã€‚",
                isFavorite: false
            },
            {
                id: 4,
                chinese: "ç¥ç§˜",
                english: "mysterious",
                phonetic: "/mÉªËˆstÉªriÉ™s/",
                chineseMeaning: "ç¥ç§˜çš„ï¼Œéš¾ä»¥ç†è§£çš„",
                exampleEN: "There was a mysterious package at the door.",
                exampleCN: "é—¨å£æœ‰ä¸€ä¸ªç¥ç§˜çš„åŒ…è£¹ã€‚",
                isFavorite: false
            },
            {
                id: 5,
                chinese: "å®è—",
                english: "treasure",
                phonetic: "/ËˆtreÊ’É™r/",
                chineseMeaning: "å®è—ï¼›çå®",
                exampleEN: "The pirates searched for hidden treasure.",
                exampleCN: "æµ·ç›—ä»¬å¯»æ‰¾éšè—çš„å®è—ã€‚",
                isFavorite: false
            },
            {
                id: 6,
                chinese: "å‹‡æ•¢",
                english: "brave",
                phonetic: "/breÉªv/",
                chineseMeaning: "å‹‡æ•¢çš„ï¼Œæ— ç•çš„",
                exampleEN: "She was brave enough to face her fears.",
                exampleCN: "å¥¹è¶³å¤Ÿå‹‡æ•¢å»é¢å¯¹è‡ªå·±çš„ææƒ§ã€‚",
                isFavorite: false
            },
            {
                id: 7,
                chinese: "é­”æ³•",
                english: "magic",
                phonetic: "/ËˆmÃ¦dÊ’Éªk/",
                chineseMeaning: "é­”æ³•ï¼›é­”æœ¯",
                exampleEN: "The magician performed amazing magic tricks.",
                exampleCN: "é­”æœ¯å¸ˆè¡¨æ¼”äº†ä»¤äººæƒŠå¹çš„é­”æ³•æŠ€å·§ã€‚",
                isFavorite: false
            },
            {
                id: 8,
                chinese: "æ—…ç¨‹",
                english: "journey",
                phonetic: "/ËˆdÊ’ÉœËrni/",
                chineseMeaning: "æ—…ç¨‹ï¼Œæ—…è¡Œ",
                exampleEN: "Their journey around the world took two years.",
                exampleCN: "ä»–ä»¬çš„ç¯çƒæ—…è¡ŒèŠ±äº†ä¸¤å¹´æ—¶é—´ã€‚",
                isFavorite: false
            },
            {
                id: 9,
                chinese: "æ™ºæ…§",
                english: "wisdom",
                phonetic: "/ËˆwÉªzdÉ™m/",
                chineseMeaning: "æ™ºæ…§ï¼Œæ‰æ™º",
                exampleEN: "Grandfather shared his wisdom with the children.",
                exampleCN: "ç¥–çˆ¶ä¸å­©å­ä»¬åˆ†äº«ä»–çš„æ™ºæ…§ã€‚",
                isFavorite: false
            },
            {
                id: 10,
                chinese: "åº†ç¥",
                english: "celebrate",
                phonetic: "/ËˆselÉªbreÉªt/",
                chineseMeaning: "åº†ç¥ï¼Œåº†è´º",
                exampleEN: "We will celebrate our victory with a party.",
                exampleCN: "æˆ‘ä»¬å°†ä¸¾åŠæ´¾å¯¹åº†ç¥èƒœåˆ©ã€‚",
                isFavorite: false
            }
        ];

        // æ•…äº‹æ•°æ®
        const demoStory = `åœ¨ä¸€ä¸ªç¥ç§˜çš„æ£®æ—é‡Œï¼Œå°ç‹ç‹¸è‰¾ç±³å¼€å§‹äº†ä¸€åœºæƒŠå¿ƒåŠ¨é­„çš„å†’é™©ã€‚å¥¹å¬è¯´æ£®æ—æ·±å¤„è—ç€ä¼ è¯´ä¸­çš„ç¾å‘³é‡‘è‹¹æœï¼Œè¿™äº›è‹¹æœæœ‰ç€ç¥å¥‡çš„é­”æ³•åŠ›é‡ã€‚

è‰¾ç±³éœ€è¦è¶³å¤Ÿçš„å‹‡æ•¢æ¥å®Œæˆè¿™æ¬¡æ—…ç¨‹ã€‚å¥¹ç©¿è¿‡æµ“é›¾ç¬¼ç½©çš„å³¡è°·ï¼Œè¶Šè¿‡æ¹æ€¥çš„æ²³æµï¼Œè·¯ä¸Šé‡åˆ°äº†å„ç§ç¥ç§˜çš„ç”Ÿç‰©ã€‚ä¸€åªæ™ºæ…§çš„è€çŒ«å¤´é¹°å‘Šè¯‰å¥¹ï¼š"çœŸæ­£çš„å®è—ä¸åœ¨äºæ‰¾åˆ°é‡‘è‹¹æœï¼Œè€Œåœ¨äºæ—…ç¨‹ä¸­è·å¾—çš„æˆé•¿ã€‚"

ç»è¿‡ä¸‰å¤©çš„è·‹æ¶‰ï¼Œè‰¾ç±³ç»ˆäºæ‰¾åˆ°äº†é‚£æ£µé—ªè€€ç€é‡‘è‰²å…‰èŠ’çš„è‹¹æœæ ‘ã€‚æ¯ä¸€é¢—è‹¹æœéƒ½æ•£å‘ç€è¯±äººçš„ç¾å‘³é¦™æ°”ã€‚å¥¹å°å¿ƒåœ°æ‘˜ä¸‹ä¸€é¢—ï¼Œç¬é—´æ„Ÿå—åˆ°äº†æ¸©æš–çš„åŠ›é‡æµè¿‡å…¨èº«ã€‚

å›åˆ°æ‘åº„åï¼Œæ‰€æœ‰çš„åŠ¨ç‰©éƒ½æ¥åº†ç¥è‰¾ç±³çš„å½’æ¥ã€‚å¥¹åˆ†äº«äº†è‡ªå·±çš„ç»å†ï¼Œå¹¶å‘Šè¯‰å¤§å®¶ï¼š"è¿™æ¬¡å†’é™©è®©æˆ‘æ˜ç™½ï¼Œå‹‡æ°”å’Œæ™ºæ…§æ‰æ˜¯äººç”Ÿæœ€å®è´µçš„è´¢å¯Œã€‚"ä»æ­¤ï¼Œæ£®æ—é‡Œæµä¼ ç€è¿™ä¸ªå…³äºå‹‡æ°”å’Œæˆé•¿çš„ç¾ä¸½æ•…äº‹ã€‚`;

        // æ•…äº‹å•è¯æ ‡è®°æ˜ å°„
        const storyWordMapping = [
            { chinese: "ç¥ç§˜", position: 3 },
            { chinese: "å†’é™©", position: 15 },
            { chinese: "ç¾å‘³", position: 40 },
            { chinese: "é­”æ³•", position: 55 },
            { chinese: "å‹‡æ•¢", position: 75 },
            { chinese: "æ—…ç¨‹", position: 85 },
            { chinese: "æ™ºæ…§", position: 115 },
            { chinese: "å®è—", position: 125 },
            { chinese: "è‹¹æœ", position: 160 },
            { chinese: "åº†ç¥", position: 235 }
        ];

        // ================================
        // åº”ç”¨çŠ¶æ€å’ŒDOMå…ƒç´ 
        // ================================
        
        // åº”ç”¨çŠ¶æ€
        let appState = {
            words: [...demoWords],
            story: demoStory,
            wordMapping: [...storyWordMapping],
            showEnglishMode: false,
            currentWord: null
        };

        // DOMå…ƒç´ 
        const storyContainer = document.getElementById('storyContainer');
        const wordsList = document.getElementById('wordsList');
        const wordModal = document.getElementById('wordModal');
        const closeModal = document.getElementById('closeModal');
        const toggleModeBtn = document.getElementById('toggleMode');
        const speakWordBtn = document.getElementById('speakWord');
        const speakExampleBtn = document.getElementById('speakExample');
        const toggleFavoriteBtn = document.getElementById('toggleFavorite');

        // ================================
        // æ ¸å¿ƒåŠŸèƒ½å‡½æ•°
        // ================================

        // åˆå§‹åŒ–åº”ç”¨
        function initApp() {
            renderStory();
            renderWordsList();
            setupEventListeners();
            loadFavorites();
        }

        // æ¸²æŸ“æ•…äº‹å†…å®¹
        function renderStory() {
            let storyText = appState.story;
            
            // æ ¹æ®æ¨¡å¼æ˜¾ç¤ºä¸­æ–‡æˆ–è‹±æ–‡
            if (appState.showEnglishMode) {
                // æ˜¾ç¤ºè‹±æ–‡æ¨¡å¼ï¼šå°†æ•…äº‹ä¸­çš„ä¸­æ–‡å•è¯æ›¿æ¢ä¸ºè‹±æ–‡
                appState.wordMapping.forEach(mapping => {
                    const word = appState.words.find(w => w.chinese === mapping.chinese);
                    if (word) {
                        storyText = storyText.replace(
                            new RegExp(mapping.chinese, 'g'),
                            `<span class="word-english" data-word-id="${word.id}">${word.english}</span>`
                        );
                    }
                });
            } else {
                // æ˜¾ç¤ºä¸­æ–‡æ¨¡å¼ï¼šæ ‡è®°ä¸­æ–‡å•è¯
                appState.wordMapping.forEach(mapping => {
                    const word = appState.words.find(w => w.chinese === mapping.chinese);
                    if (word) {
                        storyText = storyText.replace(
                            new RegExp(mapping.chinese, 'g'),
                            `<span class="word-chinese" data-word-id="${word.id}">${mapping.chinese}</span>`
                        );
                    }
                });
            }
            
            storyContainer.innerHTML = `<p>${storyText}</p>`;
            
            // ä¸ºå•è¯æ·»åŠ ç‚¹å‡»äº‹ä»¶
            document.querySelectorAll('.word-chinese, .word-english').forEach(element => {
                element.addEventListener('click', function() {
                    const wordId = parseInt(this.getAttribute('data-word-id'));
                    showWordModal(wordId);
                });
            });
        }

        // æ¸²æŸ“å•è¯åˆ—è¡¨
        function renderWordsList() {
            wordsList.innerHTML = '';
            
            appState.words.forEach(word => {
                const wordCard = document.createElement('div');
                wordCard.className = 'word-card';
                wordCard.setAttribute('data-word-id', word.id);
                
                wordCard.innerHTML = `
                    <div class="favorite-star">${word.isFavorite ? 'â˜…' : 'â˜†'}</div>
                    <h4>${word.chinese} / ${word.english}</h4>
                    <div class="phonetic">${word.phonetic}</div>
                    <div class="meaning">${word.chineseMeaning}</div>
                `;
                
                wordCard.addEventListener('click', () => showWordModal(word.id));
                wordsList.appendChild(wordCard);
            });
        }

        // æ˜¾ç¤ºå•è¯è¯¦æƒ…å¼¹çª—
        function showWordModal(wordId) {
            const word = appState.words.find(w => w.id === wordId);
            if (!word) return;
            
            appState.currentWord = word;
            
            // æ›´æ–°å¼¹çª—å†…å®¹
            document.getElementById('modalEnglish').textContent = word.english;
            document.getElementById('modalPhonetic').textContent = word.phonetic;
            document.getElementById('modalChinese').textContent = word.chineseMeaning;
            document.getElementById('modalExampleEN').textContent = word.exampleEN;
            document.getElementById('modalExampleCN').textContent = word.exampleCN;
            
            // æ›´æ–°æ”¶è—æŒ‰é’®çŠ¶æ€
            toggleFavoriteBtn.textContent = word.isFavorite ? 'â˜… å–æ¶ˆæ”¶è—' : 'â˜† æ”¶è—';
            toggleFavoriteBtn.classList.toggle('favorited', word.isFavorite);
            
            // æ˜¾ç¤ºå¼¹çª—
            wordModal.style.display = 'flex';
        }

        // æœ—è¯»æ–‡æœ¬
        function speakText(text, lang = 'en-US') {
            if ('speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = lang;
                utterance.rate = 0.8;
                utterance.pitch = 1;
                utterance.volume = 1;
                window.speechSynthesis.speak(utterance);
            } else {
                alert('æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒè¯­éŸ³æœ—è¯»åŠŸèƒ½ï¼Œè¯·ä½¿ç”¨Chromeã€Edgeç­‰ç°ä»£æµè§ˆå™¨');
            }
        }

        // åˆ‡æ¢æ”¶è—çŠ¶æ€
        function toggleFavorite() {
            if (!appState.currentWord) return;
            
            const word = appState.currentWord;
            word.isFavorite = !word.isFavorite;
            
            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            toggleFavoriteBtn.textContent = word.isFavorite ? 'â˜… å–æ¶ˆæ”¶è—' : 'â˜† æ”¶è—';
            toggleFavoriteBtn.classList.toggle('favorited', word.isFavorite);
            
            // æ›´æ–°åˆ—è¡¨æ˜¾ç¤º
            renderWordsList();
            
            // ä¿å­˜åˆ°LocalStorage
            saveFavorites();
        }

        // ä¿å­˜æ”¶è—çŠ¶æ€åˆ°LocalStorage
        function saveFavorites() {
            const favorites = appState.words
                .filter(word => word.isFavorite)
                .map(word => word.id);
            
            localStorage.setItem('wordFavorites', JSON.stringify(favorites));
        }

        // ä»LocalStorageåŠ è½½æ”¶è—çŠ¶æ€
        function loadFavorites() {
            try {
                const favorites = JSON.parse(localStorage.getItem('wordFavorites') || '[]');
                
                appState.words.forEach(word => {
                    word.isFavorite = favorites.includes(word.id);
                });
                
                renderWordsList();
            } catch (error) {
                console.log('åŠ è½½æ”¶è—æ•°æ®å¤±è´¥ï¼Œä½¿ç”¨é»˜è®¤æ•°æ®');
            }
        }

        // è®¾ç½®äº‹ä»¶ç›‘å¬å™¨
        function setupEventListeners() {
            // åˆ‡æ¢æ˜¾ç¤ºæ¨¡å¼
            toggleModeBtn.addEventListener('click', () => {
                appState.showEnglishMode = !appState.showEnglishMode;
                toggleModeBtn.textContent = appState.showEnglishMode ? 'æ˜¾ç¤ºä¸­æ–‡æ¨¡å¼' : 'æ˜¾ç¤ºè‹±æ–‡æ¨¡å¼';
                renderStory();
            });
            
            // å…³é—­å¼¹çª—
            closeModal.addEventListener('click', () => {
                wordModal.style.display = 'none';
            });
            
            // ç‚¹å‡»å¼¹çª—å¤–éƒ¨å…³é—­
            wordModal.addEventListener('click', (e) => {
                if (e.target === wordModal) {
                    wordModal.style.display = 'none';
                }
            });
            
            // è¯­éŸ³åŠŸèƒ½
            speakWordBtn.addEventListener('click', () => {
                if (appState.currentWord) {
                    speakText(appState.currentWord.english);
                }
            });
            
            speakExampleBtn.addEventListener('click', () => {
                if (appState.currentWord) {
                    speakText(appState.currentWord.exampleEN);
                }
            });
            
            // æ”¶è—åŠŸèƒ½
            toggleFavoriteBtn.addEventListener('click', toggleFavorite);
            
            // ESCé”®å…³é—­å¼¹çª—
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape' && wordModal.style.display === 'flex') {
                    wordModal.style.display = 'none';
                }
            });
        }

        // ================================
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–åº”ç”¨
        // ================================
        document.addEventListener('DOMContentLoaded', initApp);

        // ================================
        // æµ‹è¯•åŠŸèƒ½ï¼ˆæ§åˆ¶å°å¯ç”¨ï¼‰
        // ================================
        window.testFunctions = {
            // æ˜¾ç¤ºæ‰€æœ‰å•è¯
            showAllWords: function() {
                console.log('æ‰€æœ‰å•è¯:', appState.words);
                return appState.words;
            },
            
            // æ˜¾ç¤ºæ”¶è—çš„å•è¯
            showFavorites: function() {
                const favorites = appState.words.filter(word => word.isFavorite);
                console.log('æ”¶è—çš„å•è¯:', favorites);
                return favorites;
            },
            
            // æ¸…é™¤æ‰€æœ‰æ”¶è—
            clearFavorites: function() {
                appState.words.forEach(word => word.isFavorite = false);
                localStorage.removeItem('wordFavorites');
                renderWordsList();
                console.log('å·²æ¸…é™¤æ‰€æœ‰æ”¶è—');
            },
            
            // æ·»åŠ æµ‹è¯•å•è¯
            addTestWord: function() {
                const newWord = {
                    id: appState.words.length + 1,
                    chinese: "æµ‹è¯•",
                    english: "test",
                    phonetic: "/test/",
                    chineseMeaning: "æµ‹è¯•ï¼Œè¯•éªŒ",
                    exampleEN: "This is a test sentence.",
                    exampleCN: "è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•å¥å­ã€‚",
                    isFavorite: false
                };
                appState.words.push(newWord);
                renderWordsList();
                console.log('å·²æ·»åŠ æµ‹è¯•å•è¯:', newWord);
            }
        };

        // åœ¨æ§åˆ¶å°æç¤ºå¯ç”¨æµ‹è¯•å‡½æ•°
        console.log('ğŸ® æµ‹è¯•åŠŸèƒ½å¯ç”¨:');
        console.log('  - testFunctions.showAllWords() - æ˜¾ç¤ºæ‰€æœ‰å•è¯');
        console.log('  - testFunctions.showFavorites() - æ˜¾ç¤ºæ”¶è—çš„å•è¯');
        console.log('  - testFunctions.clearFavorites() - æ¸…é™¤æ‰€æœ‰æ”¶è—');
        console.log('  - testFunctions.addTestWord() - æ·»åŠ æµ‹è¯•å•è¯');
    </script>
</body>
</html>